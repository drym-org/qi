<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>8&nbsp;Field Guide</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Qi:<span class="mywbr"> &nbsp;</span> An Embeddable Flow-<wbr></wbr>Oriented Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Using_These_Docs.html" class="tocviewlink" data-pltdoc="x">Using These Docs</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Introduction_and_Usage.html" class="tocviewlink" data-pltdoc="x">Introduction and Usage</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Tutorial.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Language_Interface.html" class="tocviewlink" data-pltdoc="x">Language Interface</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Qi_Forms.html" class="tocviewlink" data-pltdoc="x">The Qi Language</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="List_Operations.html" class="tocviewlink" data-pltdoc="x">List Operations</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Qi_Macros.html" class="tocviewlink" data-pltdoc="x">Qi Macros</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Field Guide</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Principles_of_Qi.html" class="tocviewlink" data-pltdoc="x">Principles of Qi</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="When_Should_I_Use_Qi_.html" class="tocviewlink" data-pltdoc="x">When Should I Use Qi?</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Flowing_with_the_Flow.html" class="tocviewlink" data-pltdoc="x">Input Methods</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>8&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Field Guide</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">8.1&nbsp;</td><td><a href="#%28part._.Writing_.Flows%29" class="tocviewlink" data-pltdoc="x">Writing Flows</a></td></tr><tr><td align="right">8.2&nbsp;</td><td><a href="#%28part._.Debugging%29" class="tocviewlink" data-pltdoc="x">Debugging</a></td></tr><tr><td align="right">8.3&nbsp;</td><td><a href="#%28part._.Effectively_.Using_.Feedback_.Loops%29" class="tocviewlink" data-pltdoc="x">Effectively Using Feedback Loops</a></td></tr><tr><td align="right">8.4&nbsp;</td><td><a href="#%28part._.Idioms_and_.Transforms%29" class="tocviewlink" data-pltdoc="x">Idioms and Transforms</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">8.1<tt>&nbsp;</tt></span><a href="#%28part._.Writing_.Flows%29" class="tocsubseclink" data-pltdoc="x">Writing Flows</a></td></tr><tr><td><span class="tocsublinknumber">8.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Start_by_.Drawing_a_.Circuit_.Diagram%29" class="tocsubseclink" data-pltdoc="x">Start by Drawing a Circuit Diagram</a></td></tr><tr><td><span class="tocsublinknumber">8.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Use_.Small_.Building_.Blocks%29" class="tocsubseclink" data-pltdoc="x">Use Small Building Blocks</a></td></tr><tr><td><span class="tocsublinknumber">8.1.3<tt>&nbsp;</tt></span><a href="#%28part._.Carry_.Your_.Toolbox%29" class="tocsubseclink" data-pltdoc="x">Carry Your Toolbox</a></td></tr><tr><td><span class="tocsublinknumber">8.1.4<tt>&nbsp;</tt></span><a href="#%28part._.Separate_.Effects_from_.Other_.Computations%29" class="tocsubseclink" data-pltdoc="x">Separate Effects from Other Computations</a></td></tr><tr><td><span class="tocsublinknumber">8.2<tt>&nbsp;</tt></span><a href="#%28part._.Debugging%29" class="tocsubseclink" data-pltdoc="x">Debugging</a></td></tr><tr><td><span class="tocsublinknumber">8.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Using_.Side_.Effects%29" class="tocsubseclink" data-pltdoc="x">Using Side Effects</a></td></tr><tr><td><span class="tocsublinknumber">8.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Using_a_.Probe%29" class="tocsubseclink" data-pltdoc="x">Using a Probe</a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">probe</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._readout%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">readout</span></a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._qi~3aprobe%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">qi:<span class="mywbr"> &nbsp;</span>probe</span></a></td></tr><tr><td><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._define-probed-flow%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">define-<wbr></wbr>probed-<wbr></wbr>flow</span></a></td></tr><tr><td><span class="tocsublinknumber">8.2.3<tt>&nbsp;</tt></span><a href="#%28part._.Using_.Fixtures%29" class="tocsubseclink" data-pltdoc="x">Using Fixtures</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4<tt>&nbsp;</tt></span><a href="#%28part._.Common_.Errors_and_.What_.They_.Mean%29" class="tocsubseclink" data-pltdoc="x">Common Errors and What They Mean</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Expected_.Number_of_.Values_.Not_.Received%29" class="tocsubseclink" data-pltdoc="x">Expected Number of Values Not Received</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Wildcard_.Not_.Allowed_as_an_.Expression%29" class="tocsubseclink" data-pltdoc="x">Wildcard Not Allowed as an Expression</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.3<tt>&nbsp;</tt></span><a href="#%28part.____.Not_.Allowed_as_an_.Expression%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">~@</span></span> Not Allowed as an Expression</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.4<tt>&nbsp;</tt></span><a href="#%28part._.Bad_.Syntax%29" class="tocsubseclink" data-pltdoc="x">Bad Syntax</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.5<tt>&nbsp;</tt></span><a href="#%28part._.Use_.Does_.Not_.Match_.Pattern%29" class="tocsubseclink" data-pltdoc="x">Use Does Not Match Pattern</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.6<tt>&nbsp;</tt></span><a href="#%28part._.Expected_.Identifier_.Not_.Starting_.With_.Character%29" class="tocsubseclink" data-pltdoc="x">Expected Identifier Not Starting With Character</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.7<tt>&nbsp;</tt></span><a href="#%28part._.Identifier_s_.Binding_is_.Ambiguous%29" class="tocsubseclink" data-pltdoc="x">Identifier&rsquo;s Binding is Ambiguous</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.8<tt>&nbsp;</tt></span><a href="#%28part._.Not_.Defined_as_.Syntax_.Class%29" class="tocsubseclink" data-pltdoc="x">Not Defined as Syntax Class</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.9<tt>&nbsp;</tt></span><a href="#%28part._.Too_.Many_.Ellipses_in_.Template%29" class="tocsubseclink" data-pltdoc="x">Too Many Ellipses in Template</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.10<tt>&nbsp;</tt></span><a href="#%28part._.Syntax__.Unbound_.Identifier%29" class="tocsubseclink" data-pltdoc="x">Syntax:<span class="mywbr"> &nbsp;</span> Unbound Identifier</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.11<tt>&nbsp;</tt></span><a href="#%28part._.Undefined%29" class="tocsubseclink" data-pltdoc="x">Undefined</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.12<tt>&nbsp;</tt></span><a href="#%28part._map_filter_.Contract_.Violation%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">map</span></span>/<span class="RktSym"><span class="RktValLink">filter</span></span> Contract Violation</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.13<tt>&nbsp;</tt></span><a href="#%28part._.Compose__.Contract_.Violation%29" class="tocsubseclink" data-pltdoc="x">Compose:<span class="mywbr"> &nbsp;</span> Contract Violation</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.14<tt>&nbsp;</tt></span><a href="#%28part._.List_.Arity_.Mismatch%29" class="tocsubseclink" data-pltdoc="x">List Arity Mismatch</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.15<tt>&nbsp;</tt></span><a href="#%28part._.Fancy-app_.Arity_.Mismatch%29" class="tocsubseclink" data-pltdoc="x">Fancy-<wbr></wbr>app Arity Mismatch</a></td></tr><tr><td><span class="tocsublinknumber">8.2.4.16<tt>&nbsp;</tt></span><a href="#%28part._.Application__.Not_a_.Procedure%29" class="tocsubseclink" data-pltdoc="x">Application:<span class="mywbr"> &nbsp;</span> Not a Procedure</a></td></tr><tr><td><span class="tocsublinknumber">8.2.5<tt>&nbsp;</tt></span><a href="#%28part._.Gotchas%29" class="tocsubseclink" data-pltdoc="x">Gotchas</a></td></tr><tr><td><span class="tocsublinknumber">8.2.5.1<tt>&nbsp;</tt></span><a href="#%28part._null_is_.Not_a_.Literal%29" class="tocsubseclink" data-pltdoc="x">null is Not a Literal</a></td></tr><tr><td><span class="tocsublinknumber">8.2.5.2<tt>&nbsp;</tt></span><a href="#%28part._.There_s_.No_.Escaping_esc%29" class="tocsubseclink" data-pltdoc="x">There&rsquo;s No Escaping <span class="RktSym">esc</span></a></td></tr><tr><td><span class="tocsublinknumber">8.2.5.3<tt>&nbsp;</tt></span><a href="#%28part._.Mutable_.Values_.Defy_the_.Laws_of_.Flows%29" class="tocsubseclink" data-pltdoc="x">Mutable Values Defy the Laws of Flows</a></td></tr><tr><td><span class="tocsublinknumber">8.2.5.4<tt>&nbsp;</tt></span><a href="#%28part._.Order_of_.Effects%29" class="tocsubseclink" data-pltdoc="x">Order of Effects</a></td></tr><tr><td><span class="tocsublinknumber">8.3<tt>&nbsp;</tt></span><a href="#%28part._.Effectively_.Using_.Feedback_.Loops%29" class="tocsubseclink" data-pltdoc="x">Effectively Using Feedback Loops</a></td></tr><tr><td><span class="tocsublinknumber">8.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Control_.Values_and_.Data_.Values%29" class="tocsubseclink" data-pltdoc="x">Control Values and Data Values</a></td></tr><tr><td><span class="tocsublinknumber">8.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Input_.Tracing%29" class="tocsubseclink" data-pltdoc="x">Input Tracing</a></td></tr><tr><td><span class="tocsublinknumber">8.3.3<tt>&nbsp;</tt></span><a href="#%28part._.Keeping_.It_.Tidy%29" class="tocsubseclink" data-pltdoc="x">Keeping It Tidy</a></td></tr><tr><td><span class="tocsublinknumber">8.4<tt>&nbsp;</tt></span><a href="#%28part._.Idioms_and_.Transforms%29" class="tocsubseclink" data-pltdoc="x">Idioms and Transforms</a></td></tr><tr><td><span class="tocsublinknumber">8.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Nested_.Applications_are_.Sequential_.Flows%29" class="tocsubseclink" data-pltdoc="x">Nested Applications are Sequential Flows</a></td></tr><tr><td><span class="tocsublinknumber">8.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Converting_a_.Function_to_a_.Closure%29" class="tocsubseclink" data-pltdoc="x">Converting a Function to a Closure</a></td></tr><tr><td><span class="tocsublinknumber">8.4.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Basic_.Recipe%29" class="tocsubseclink" data-pltdoc="x">Basic Recipe</a></td></tr><tr><td><span class="tocsublinknumber">8.4.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Definition_vs_.Invocation_.Inputs%29" class="tocsubseclink" data-pltdoc="x">Definition vs Invocation Inputs</a></td></tr><tr><td><span class="tocsublinknumber">8.4.3<tt>&nbsp;</tt></span><a href="#%28part._.Converting_a_.Macro_to_a_.Flow%29" class="tocsubseclink" data-pltdoc="x">Converting a Macro to a Flow</a></td></tr><tr><td><span class="tocsublinknumber">8.4.4<tt>&nbsp;</tt></span><a href="#%28part._.Bindings_are_an_.Alternative_to_.Nonlinearity%29" class="tocsubseclink" data-pltdoc="x">Bindings are an Alternative to Nonlinearity</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Qi_Macros.html" title="backward to &quot;7 Qi Macros&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: An Embeddable Flow-Oriented Language&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Principles_of_Qi.html" title="forward to &quot;9 Principles of Qi&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h3 class="heading">8<tt>&nbsp;</tt><a name="(part._.Field_.Guide)"></a>Field Guide<span class="button-group"><a href="#(part._.Field_.Guide)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h3><p>This chapter contains practical advice on using Qi. It includes recipes for doing various things, advice on gotchas, troubleshooting commonly encountered errors, and other tips you may find useful "in the field."</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Writing_.Flows%29" class="toclink" data-pltdoc="x">8.1<span class="hspace">&nbsp;</span>Writing Flows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Start_by_.Drawing_a_.Circuit_.Diagram%29" class="toclink" data-pltdoc="x">8.1.1<span class="hspace">&nbsp;</span>Start by Drawing a Circuit Diagram</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Use_.Small_.Building_.Blocks%29" class="toclink" data-pltdoc="x">8.1.2<span class="hspace">&nbsp;</span>Use Small Building Blocks</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Carry_.Your_.Toolbox%29" class="toclink" data-pltdoc="x">8.1.3<span class="hspace">&nbsp;</span>Carry Your Toolbox</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Separate_.Effects_from_.Other_.Computations%29" class="toclink" data-pltdoc="x">8.1.4<span class="hspace">&nbsp;</span>Separate Effects from Other Computations</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Debugging%29" class="toclink" data-pltdoc="x">8.2<span class="hspace">&nbsp;</span>Debugging</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Using_.Side_.Effects%29" class="toclink" data-pltdoc="x">8.2.1<span class="hspace">&nbsp;</span>Using Side Effects</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Using_a_.Probe%29" class="toclink" data-pltdoc="x">8.2.2<span class="hspace">&nbsp;</span>Using a Probe</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Using_.Fixtures%29" class="toclink" data-pltdoc="x">8.2.3<span class="hspace">&nbsp;</span>Using Fixtures</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Common_.Errors_and_.What_.They_.Mean%29" class="toclink" data-pltdoc="x">8.2.4<span class="hspace">&nbsp;</span>Common Errors and What They Mean</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Expected_.Number_of_.Values_.Not_.Received%29" class="toclink" data-pltdoc="x">8.2.4.1<span class="hspace">&nbsp;</span>Expected Number of Values Not Received</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Wildcard_.Not_.Allowed_as_an_.Expression%29" class="toclink" data-pltdoc="x">8.2.4.2<span class="hspace">&nbsp;</span>Wildcard Not Allowed as an Expression</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part.____.Not_.Allowed_as_an_.Expression%29" class="toclink" data-pltdoc="x">8.2.4.3<span class="hspace">&nbsp;</span><span class="RktSym"><span class="RktStxLink">~@</span></span> Not Allowed as an Expression</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Bad_.Syntax%29" class="toclink" data-pltdoc="x">8.2.4.4<span class="hspace">&nbsp;</span>Bad Syntax</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Use_.Does_.Not_.Match_.Pattern%29" class="toclink" data-pltdoc="x">8.2.4.5<span class="hspace">&nbsp;</span>Use Does Not Match Pattern</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Expected_.Identifier_.Not_.Starting_.With_.Character%29" class="toclink" data-pltdoc="x">8.2.4.6<span class="hspace">&nbsp;</span>Expected Identifier Not Starting With Character</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Identifier_s_.Binding_is_.Ambiguous%29" class="toclink" data-pltdoc="x">8.2.4.7<span class="hspace">&nbsp;</span>Identifier&rsquo;s Binding is Ambiguous</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Not_.Defined_as_.Syntax_.Class%29" class="toclink" data-pltdoc="x">8.2.4.8<span class="hspace">&nbsp;</span>Not Defined as Syntax Class</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Too_.Many_.Ellipses_in_.Template%29" class="toclink" data-pltdoc="x">8.2.4.9<span class="hspace">&nbsp;</span>Too Many Ellipses in Template</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Syntax__.Unbound_.Identifier%29" class="toclink" data-pltdoc="x">8.2.4.10<span class="hspace">&nbsp;</span>Syntax: Unbound Identifier</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Undefined%29" class="toclink" data-pltdoc="x">8.2.4.11<span class="hspace">&nbsp;</span>Undefined</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._map_filter_.Contract_.Violation%29" class="toclink" data-pltdoc="x">8.2.4.12<span class="hspace">&nbsp;</span><span class="RktSym"><span class="RktValLink">map</span></span>/<span class="RktSym"><span class="RktValLink">filter</span></span> Contract Violation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Compose__.Contract_.Violation%29" class="toclink" data-pltdoc="x">8.2.4.13<span class="hspace">&nbsp;</span>Compose: Contract Violation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.List_.Arity_.Mismatch%29" class="toclink" data-pltdoc="x">8.2.4.14<span class="hspace">&nbsp;</span>List Arity Mismatch</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Fancy-app_.Arity_.Mismatch%29" class="toclink" data-pltdoc="x">8.2.4.15<span class="hspace">&nbsp;</span>Fancy-app Arity Mismatch</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Application__.Not_a_.Procedure%29" class="toclink" data-pltdoc="x">8.2.4.16<span class="hspace">&nbsp;</span>Application: Not a Procedure</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Gotchas%29" class="toclink" data-pltdoc="x">8.2.5<span class="hspace">&nbsp;</span>Gotchas</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._null_is_.Not_a_.Literal%29" class="toclink" data-pltdoc="x">8.2.5.1<span class="hspace">&nbsp;</span>null is Not a Literal</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.There_s_.No_.Escaping_esc%29" class="toclink" data-pltdoc="x">8.2.5.2<span class="hspace">&nbsp;</span>There&rsquo;s No Escaping <span class="RktSym">esc</span></a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Mutable_.Values_.Defy_the_.Laws_of_.Flows%29" class="toclink" data-pltdoc="x">8.2.5.3<span class="hspace">&nbsp;</span>Mutable Values Defy the Laws of Flows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Order_of_.Effects%29" class="toclink" data-pltdoc="x">8.2.5.4<span class="hspace">&nbsp;</span>Order of Effects</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Effectively_.Using_.Feedback_.Loops%29" class="toclink" data-pltdoc="x">8.3<span class="hspace">&nbsp;</span>Effectively Using Feedback Loops</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Control_.Values_and_.Data_.Values%29" class="toclink" data-pltdoc="x">8.3.1<span class="hspace">&nbsp;</span>Control Values and Data Values</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Input_.Tracing%29" class="toclink" data-pltdoc="x">8.3.2<span class="hspace">&nbsp;</span>Input Tracing</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Keeping_.It_.Tidy%29" class="toclink" data-pltdoc="x">8.3.3<span class="hspace">&nbsp;</span>Keeping It Tidy</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Idioms_and_.Transforms%29" class="toclink" data-pltdoc="x">8.4<span class="hspace">&nbsp;</span>Idioms and Transforms</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Nested_.Applications_are_.Sequential_.Flows%29" class="toclink" data-pltdoc="x">8.4.1<span class="hspace">&nbsp;</span>Nested Applications are Sequential Flows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Converting_a_.Function_to_a_.Closure%29" class="toclink" data-pltdoc="x">8.4.2<span class="hspace">&nbsp;</span>Converting a Function to a Closure</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Basic_.Recipe%29" class="toclink" data-pltdoc="x">8.4.2.1<span class="hspace">&nbsp;</span>Basic Recipe</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Definition_vs_.Invocation_.Inputs%29" class="toclink" data-pltdoc="x">8.4.2.2<span class="hspace">&nbsp;</span>Definition vs Invocation Inputs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Converting_a_.Macro_to_a_.Flow%29" class="toclink" data-pltdoc="x">8.4.3<span class="hspace">&nbsp;</span>Converting a Macro to a Flow</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Bindings_are_an_.Alternative_to_.Nonlinearity%29" class="toclink" data-pltdoc="x">8.4.4<span class="hspace">&nbsp;</span>Bindings are an Alternative to Nonlinearity</a></p></td></tr></table><h4 class="heading">8.1<tt>&nbsp;</tt><a name="(part._.Writing_.Flows)"></a>Writing Flows<span class="button-group"><a href="#(part._.Writing_.Flows)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><h5 class="heading">8.1.1<tt>&nbsp;</tt><a name="(part._.Start_by_.Drawing_a_.Circuit_.Diagram)"></a>Start by Drawing a Circuit Diagram<span class="button-group"><a href="#(part._.Start_by_.Drawing_a_.Circuit_.Diagram)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Before you write a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>, consider drawing out a "circuit diagram" on paper. Start by drawing wires corresponding to the inputs, and then draw boxes for each transformation and trace out what happens to the outputs. This practice is the Qi equivalent of writing "pseudocode" with other languages, and is especially useful when writing complex flows entailing folds and loops. With practice, this can become second nature and can be a very helpful recourse.</p><h5 class="heading">8.1.2<tt>&nbsp;</tt><a name="(part._.Use_.Small_.Building_.Blocks)"></a>Use Small Building Blocks<span class="button-group"><a href="#(part._.Use_.Small_.Building_.Blocks)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Decompose your <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> into its smallest components, and name each so that they are independent flows. Qi flows, by virtue of being functions, are highly composable, and are, by the same token, eminently decomposable. This tends to make refactoring flows a much more reliable undertaking than it typically is in other languages.</p><h5 class="heading">8.1.3<tt>&nbsp;</tt><a name="(part._.Carry_.Your_.Toolbox)"></a>Carry Your Toolbox<span class="button-group"><a href="#(part._.Carry_.Your_.Toolbox)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A journeyman of one&rsquo;s craft &ndash; a woodworker, electrician, or a plumber, say &ndash; always goes to work with a trusty toolbox that contains the tools of the trade, some perhaps even of their own design. An electrician, for instance, may have a voltage tester, a multimeter, and a continuity tester in her toolbox. Although these are "debugging" tools, they aren&rsquo;t just for identifying bugs &ndash; by providing rapid feedback, they enable her to explore and find creative solutions quickly and reliably. It&rsquo;s the same with Qi. Learn to use the <a href="#%28part._.Debugging%29" data-pltdoc="x">debugging tools</a>, and use them often.</p><h5 class="heading">8.1.4<tt>&nbsp;</tt><a name="(part._.Separate_.Effects_from_.Other_.Computations)"></a>Separate Effects from Other Computations<span class="button-group"><a href="#(part._.Separate_.Effects_from_.Other_.Computations)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>In functional programming, "effects" refer to anything a function does that is not captured in its inputs and outputs. This could include things like printing to the screen, writing to a file, or mutating a global variable.</p><p>In general, pure functions (that is, functions free of such effects) are easier to understand and easier to reuse, and favoring their use is considered good functional style. But of course, it&rsquo;s necessary for your code to actually do things besides compute values, too! There are many ways in which you might combine effects and pure functions, from mixing them freely, as you might in Racket, to extracting them completely using monads, as you might in Haskell. Qi encourages using pure functions side by side with what we could call "pure effects."</p><p>If you have a function with ordinary inputs and outputs that also performs an effect, then, to adopt this style, decouple the effect from the rest of the function (<a href="#%28part._.Use_.Small_.Building_.Blocks%29" data-pltdoc="x">splitting it into smaller functions</a>, as necessary) and then invoke it via an explicit use of the <span class="RktSym">effect</span> form, thus neatly separating the functional computation from the effect.</p><p>Doing it this way encourages smaller, well-scoped functions that do one thing, and which serve as excellent building blocks from which to compose large and complex programs. In contrast, larger, effectful functions make poor building blocks and are difficult to compose.</p><p>To illustrate, say that we wish to perform a simple numeric transformation on an input number, but also print the intermediate values to the screen. We might do it this way:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-square</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-add1</span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">my-square</span><span class="hspace">&nbsp;</span><span class="RktSym">my-add1</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">3</span></p></td></tr><tr><td><p><span class="RktOut">9</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">10</span></p></td></tr></table></blockquote><p>This is considered poor style since we&rsquo;ve mixed pure functions with implicit effects. It makes these functions less portable since we might find use for such computations in other settings where we might prefer to avoid the side effect, or perhaps perform a different effect like writing the value to a network port. With the functions written this way, we would be encouraged to write similar functions in these different settings, exhibiting the other effects we might desire there, and duplicating the core logic.</p><p>Instead, following the above guideline, we would write it this way:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#949;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#949;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">3</span></p></td></tr><tr><td><p><span class="RktOut">9</span></p></td></tr></table></td></tr><tr><td><p><span class="RktRes">10</span></p></td></tr></table></blockquote><p>This uses the pure functions <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span> and <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span>, extracting the effectful <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" class="RktValLink" data-pltdoc="x">displayln</a></span> as an explicit <span class="RktSym">effect</span>. If we wanted to have other effects, we could simply indicate different effects here and reuse the same underlying pure functions.</p><h4 class="heading">8.2<tt>&nbsp;</tt><a name="(part._.Debugging)"></a>Debugging<span class="button-group"><a href="#(part._.Debugging)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><p>There are three prominent debugging strategies which may be used independently or in tandem &ndash; <a href="#%28part._.Using_.Side_.Effects%29" data-pltdoc="x">side effects</a>, <a href="#%28part._.Using_a_.Probe%29" data-pltdoc="x">probing</a>, and <a href="#%28part._.Using_.Fixtures%29" data-pltdoc="x">fixtures</a>.</p><h5 class="heading">8.2.1<tt>&nbsp;</tt><a name="(part._.Using_.Side_.Effects)"></a>Using Side Effects<span class="button-group"><a href="#(part._.Using_.Side_.Effects)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>The most lightweight way to debug your code is to use side effects, as this allows you to check values at various points in flows without affecting their functioning in any way. You can use this debugging approach always, even in functional Racket code that isn&rsquo;t using Qi.</p><p>This approach involves using the side-effect form, <span class="RktSym">effect</span> (or <span class="RktSym">&#949;</span>) at a particular point (or several points) in the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> in order to see or manipulate the values there. To use it in general Racket code, just wrap the Racket code with <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span> to employ Qi there (and therefore side effects).</p><p>Side effects are a natural fit for debugging functional code in general, as the example below shows.</p><p><span style="font-weight: bold">Example</span>: Racket&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/regexp.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._regexp-replace%2A%29%29" class="RktValLink" data-pltdoc="x">regexp-replace*</a></span> function transforms a string into another based on a regex-based replacement rule. It accepts a pattern, a string, and a replacement rule (as a function), and then constructs the output string by parsing the input string and calling your replacement rule function each time there is a match to the pattern. With regexes, things don&rsquo;t usually work until you&rsquo;ve gone through multiple cycles of debugging, so in this case, in order to see what arguments are being supplied to your replacement rule function, you could simply add a side effect using Qi.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/regexp.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._regexp-replace%2A%29%29" class="RktValLink" data-pltdoc="x">regexp-replace*</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">PATTERN</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">str</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">&#949;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">&gt;&lt;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._println%29%29" class="RktValLink" data-pltdoc="x">println</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">replace-rule</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><h5 class="heading">8.2.2<tt>&nbsp;</tt><a name="(part._.Using_a_.Probe)"></a><a name="(mod-path._qi/probe)"></a>Using a Probe<span class="button-group"><a href="#(part._.Using_a_.Probe)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._qi%2Fprobe%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">qi/probe</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/qi-probe" title="Install this package using `raco pkg install qi-probe`"><span class="stt">qi-probe</span></a></span></td></tr></table></p><p>Qi includes a "circuit tester" style debugger, which you can use to check the values at arbitrary points in the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>. It can be used even if the flow is raising an error &#8211; the tester can help you find the error. It offers similar functionality to <a href="https://download.racket-lang.org/releases/8.17/doc/local-redirect/index.html?tag=%28part._%28.%27%28lib._debug%2Fscribblings%2Fdebug..scrbl%29.%27._.%27top.%27%29%29" class="Sq" data-pltdoc="x">debug</a> but is specialized for functional debugging and Qi flows.</p><p>To use it, first wrap the entire expression <span class="emph">invoking</span> the flow with a <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span> form. Then, you can place a literal <span class="RktSym">readout</span> anywhere within the flow definition to cause the entire expression to evaluate to the values flowing at that point. This works even if your flow is defined elsewhere (even in another file) and only <span class="emph">used</span> at the invocation site by name.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._qi/probe..rkt)._probe))"></a><span title="Provided from: qi/probe | Package: qi-probe"><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">probe</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">flo</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><a name="(form._((lib._qi/probe..rkt)._readout))"></a><span title="Provided from: qi/probe | Package: qi-probe"><span class="RktSym"><span class="RktSymDef RktSym">readout</span></span></span></p></blockquote></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara"><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span> simply marks a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> invocation for debugging, and does not change its functionality. Then, when evaluation encounters the first occurrence of <span class="RktSym">readout</span> within <span class="RktVar">flo</span>, the values at that point are immediately returned as the value of the entire <span class="RktVar">flo</span>. This is done via a <a href="http://pkg-build.racket-lang.org/doc/reference/eval-model.html#%28tech._continuation%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation</span></a>, so that you may precede it with whatever flows you like that might help you understand what&rsquo;s happening at that point, and you don&rsquo;t have to worry about it affecting downstream flows during the process of debugging since those flows would simply never be hit. Additionally, readouts may be placed <span class="emph">anywhere</span> within the flow, and not necessarily on the main stream &ndash; it will always return the values observed at the specific point where you place the readout.</div></p><p>Note that <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span> is a Racket (rather than Qi) form, and it must wrap a flow <span class="emph">invocation</span> rather than a flow <span class="emph">definition</span>. The <span class="RktSym">readout</span>, on the other hand, is a Qi expression and must be placed somewhere within the flow <span class="emph">definition</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3e%29%29" class="RktValLink" data-pltdoc="x">&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-flow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-flow</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._qi/probe..rkt)._qi~3aprobe))"></a><span title="Provided from: qi/probe | Package: qi-probe"><span class="RktSym"><span class="RktSymDef RktSym">qi:probe</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">flo</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._qi/probe..rkt)._define-probed-flow))"></a><span title="Provided from: qi/probe | Package: qi-probe"><span class="RktSym"><span class="RktSymDef RktSym">define-probed-flow</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><span class="RktSymDef RktSym">define-probed-flow</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">arg</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">body</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara"><span style="font-weight: bold">NOTE</span>: This way to place readouts in the flow definition is intended for use in <span style="font-weight: bold">legacy versions of Racket only</span>, that is, versions 8.2 or earlier. <span class="RktSym">qi:probe</span> and <span class="RktSym">define-probed-flow</span> are <span style="font-weight: bold">no longer needed</span> in Qi (as of Racket 8.3). These forms should be considered <span style="font-weight: bold">deprecated</span> on versions 8.3 or later. On these recent versions of Racket, there is no difference in usage between inline and nonlocal flow definitions, and the <span class="RktSym">readout</span> may simply be placed wherever you want it. The legacy documentation follows.</div></p><p>When the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> you&rsquo;d like to debug is a named flow that is not defined inline at the invocation site, you&rsquo;ll need to take some extra steps to ensure that you can place a <span class="RktSym">readout</span> at the <span class="emph">definition</span> site even though the <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span> itself is placed at the <span class="emph">invocation</span> site.</p><p>To do this, either wrap the entire body of the definition, or a subflow in the definition, with <span class="RktSym">qi:probe</span>, or alternatively, use <span class="RktSym">define-probed-flow</span> instead of <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span>, which transparently does this for you. Now, you can place a (distinct) <span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span> at the invocation site, as usual, and it will receive the readout that you indicate at the definition site.</p><p><span class="RktPn">(</span><span class="RktSym">define-probed-flow</span><span class="stt"> </span><span class="RktVar">name</span><span class="stt"> </span><span class="RktVar">body</span><span class="RktPn">)</span> is equivalent to <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span><span class="stt"> </span><span class="RktVar">name</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">qi:probe</span><span class="stt"> </span><span class="RktVar">body</span><span class="RktPn">)</span><span class="RktPn">)</span> or <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="stt"> </span><span class="RktVar">name</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._flow%29%29" class="RktStxLink" data-pltdoc="x">flow</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">qi:probe</span><span class="stt"> </span><span class="RktVar">body</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-probed-flow</span><span class="hspace">&nbsp;</span><span class="RktSym">my-flow</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-flow</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-flow-too</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">qi:probe</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-flow-too</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h5 class="heading">8.2.3<tt>&nbsp;</tt><a name="(part._.Using_.Fixtures)"></a>Using Fixtures<span class="button-group"><a href="#(part._.Using_.Fixtures)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>The <a href="#%28part._.Using_a_.Probe%29" data-pltdoc="x">probe debugger</a> allows you to check values at specific points in the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>, that is, essentially, the <span class="emph">output</span> of the upstream components at that point. It is sometimes also useful to fix the <span class="emph">input</span> to downstream components. In unit testing, fixing inputs to functions to test their behavior in a known environment is referred to as writing "fixtures." It&rsquo;s the same idea.</p><p>The basic way to do it is to insert a <span class="RktSym">gen</span> form at the point of interest in the flow, as <span class="RktSym">gen</span> ignores its inputs and just produces whatever values you specify.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>Methodical use of <span class="RktSym">gen</span> together with the <a href="#%28part._.Using_a_.Probe%29" data-pltdoc="x">probe debugger</a> allows you to isolate bugs to specific sections of the flow, and then triangulate further using the same approach until you find the exact problem.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._qi%2Fprobe..rkt%29._probe%29%29" class="RktStxLink" data-pltdoc="x">probe</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"5"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktSym">readout</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><h5 class="heading">8.2.4<tt>&nbsp;</tt><a name="(part._.Common_.Errors_and_.What_.They_.Mean)"></a>Common Errors and What They Mean<span class="button-group"><a href="#(part._.Common_.Errors_and_.What_.They_.Mean)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Qi aims to produce good error messages that convey what the problem is and clearly imply a remedy. For various reasons, it may not always be possible to provide such a clear message. This section documents known errors of this kind, and suggests possible causes and remedies. If you encounter an inscrutable error, please consider <a href="https://github.com/drym-org/qi/issues/">reporting it</a>. If the error cannot be improved, then it will be documented here.</p><h5 class="heading">8.2.4.1<tt>&nbsp;</tt><a name="(part._.Expected_.Number_of_.Values_.Not_.Received)"></a>Expected Number of Values Not Received<span class="button-group"><a href="#(part._.Expected_.Number_of_.Values_.Not_.Received)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">result</span><span class="hspace">&nbsp;</span><span class="RktCmt">arity</span><span class="hspace">&nbsp;</span><span class="RktCmt">mismatch;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">expected</span><span class="hspace">&nbsp;</span><span class="RktCmt">number</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">values</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">received</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">expected:</span><span class="hspace">&nbsp;</span><span class="RktCmt">1</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">received:</span><span class="hspace">&nbsp;</span><span class="RktCmt">2</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> is either returning more or fewer values than the <a href="http://pkg-build.racket-lang.org/doc/reference/eval-model.html#%28tech._continuation%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation</span></a> of the flow is expecting. See <a href="http://pkg-build.racket-lang.org/doc/reference/eval-model.html#%28part._values-model%29" data-pltdoc="x">Multiple Return Values</a> for general information about this.</p><p><span style="font-weight: bold">Common example</span>: Attempting to assign the result of a multi-valued flow to a single variable. Use <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-values%29%29" class="RktStxLink" data-pltdoc="x">define-values</a></span> instead of <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span> here, or consider decomposing the flow into multiple flows that each return a single value.</p><p><span style="font-weight: bold">Common example</span>: Attempting to invoke a function with arguments produced by a multi-valued flow, something like <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._range%29%29" class="RktValLink" data-pltdoc="x">range</a></span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">&#9651;</span><span class="RktPn">)</span><span class="RktPn">)</span>. Function application syntax in Racket expects a single argument in each argument position, and cannot receive them all from a flow in this way. You could use <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._call-with-values%29%29" class="RktValLink" data-pltdoc="x">call-with-values</a></span> to do it, but it is much simpler to just use Qi&rsquo;s invocation syntax via a threading form, e.g. <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._range%29%29" class="RktValLink" data-pltdoc="x">range</a></span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">&#9651;</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktPn">)</span>.</p><p><span style="font-weight: bold">Common example</span>: Attempting to employ a <span class="emph">Racket</span> expression producing multiple values in an expression where the <a href="http://pkg-build.racket-lang.org/doc/reference/eval-model.html#%28tech._continuation%29" class="techoutside" data-pltdoc="x"><span class="techinside">continuation</span></a> expects one value, e.g. <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktPn">)</span>. Whether the expression is Racket or Qi, the number of values returned must be the number of values expected by the continuation &ndash; and typically, that&rsquo;s <a href="http://pkg-build.racket-lang.org/doc/reference/eval-model.html#%28part._values-model%29" data-pltdoc="x">one</a>. In this example, you could simply write the values directly as separate expressions, each producing one value, e.g. <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktPn">)</span> or <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">gen</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktPn">)</span>. If you must use a single Racket expression to produce the values, then you could use <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="RktPn">)</span>, instead.</p><p><span style="font-weight: bold">Common example</span>: Using the threading form <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span> without wrapping the input arguments in parentheses. Remember that, unlike Racket&rsquo;s usual threading macro, input arguments to Qi&rsquo;s threading form <a href="Introduction_and_Usage.html#%28part._.Relationship_to_the_.Threading_.Macro%29" data-pltdoc="x">must be wrapped in parentheses</a>.</p><h5 class="heading">8.2.4.2<tt>&nbsp;</tt><a name="(part._.Wildcard_.Not_.Allowed_as_an_.Expression)"></a>Wildcard Not Allowed as an Expression<span class="button-group"><a href="#(part._.Wildcard_.Not_.Allowed_as_an_.Expression)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">_:</span><span class="hspace">&nbsp;</span><span class="RktCmt">wildcard</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">allowed</span><span class="hspace">&nbsp;</span><span class="RktCmt">as</span><span class="hspace">&nbsp;</span><span class="RktCmt">an</span><span class="hspace">&nbsp;</span><span class="RktCmt">expression</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">in:</span><span class="hspace">&nbsp;</span><span class="RktCmt">_</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span> is a valid <span class="emph">Qi</span> expression but an invalid <span class="emph">Racket</span> expression. Somewhere in the course of evaluation of your code, the interpreter received <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span> and was asked to evaluate it as a <span class="emph">Racket</span> expression. It doesn&rsquo;t like this.</p><p><span style="font-weight: bold">Common example</span>: Trying to evaluate a Qi expression without having required the Qi library, so that the expression is evaluated as a Racket expression. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">qi</span><span class="RktPn">)</span> should do it.</p><p><span style="font-weight: bold">Common example</span>: Trying to use a template inside a nested application. For instance, <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span> is invalid because, within the <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span> template, the language is <span class="emph">Racket</span> rather than Qi, and you can&rsquo;t use a Qi template (i.e. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span>) there. You might try <a href="#%28part._.Nested_.Applications_are_.Sequential_.Flows%29" data-pltdoc="x">sequencing the flow</a>, something like <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><p><span style="font-weight: bold">Common example</span>: Trying to use a Racket macro (rather than a function), or a macro from another DSL, as a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> without first registering it via <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span>. In general, Qi expects flows to be functions unless otherwise explicitly signaled.</p><h5 class="heading">8.2.4.3<tt>&nbsp;</tt><a name="(part.____.Not_.Allowed_as_an_.Expression)"></a><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span> Not Allowed as an Expression<span class="button-group"><a href="#(part.____.Not_.Allowed_as_an_.Expression)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p><span style="font-weight: bold">Meaning</span>: Somewhere in the course of evaluation of your code, the interpreter received <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span> at runtime and was asked to evaluate it as an expression. But <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span> is not a valid Racket expression outside of syntax templates in the expansion phase, where it is used to work with sequences.</p><p><span style="font-weight: bold">Common example</span>: Using <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span> in a macro template without having <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" class="RktStxLink" data-pltdoc="x">for-syntax</a></span><span class="stt"> </span><span class="RktSym">racket/base</span><span class="RktPn">)</span><span class="RktPn">)</span>. As a result, <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span> is left unchanged through expansion instead of being treated as modulating how expansion is done. Then at runtime, the evaluator complains that it got <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._~7e~40%29%29" class="RktStxLink" data-pltdoc="x">~@</a></span>.</p><h5 class="heading">8.2.4.4<tt>&nbsp;</tt><a name="(part._.Bad_.Syntax)"></a>Bad Syntax<span class="button-group"><a href="#(part._.Bad_.Syntax)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">lambda:</span><span class="hspace">&nbsp;</span><span class="RktCmt">bad</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">in:</span><span class="hspace">&nbsp;</span><span class="RktCmt">lambda</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The expander (<a href="Principles_of_Qi.html#%28part._.It_s_.Languages_.All_the_.Way_.Down%29" data-pltdoc="x">either the Racket or Qi expander</a>) received syntax, in this case simply "lambda", that it considers to be invalid. Note that if it received something it didn&rsquo;t know anything about, it would say "undefined" rather than "bad syntax." Bad syntax indicates known syntax used in an incorrect way.</p><p><span style="font-weight: bold">Common example</span>: A Racket expression has not been properly escaped within a Qi context. For instance, <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span> is invalid because the wrapped expression is Racket rather than Qi. To fix this, use <span class="RktSym">esc</span>, as in <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">not:</span><span class="hspace">&nbsp;</span><span class="RktCmt">bad</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">in:</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Common example</span>: Similar to the previous one, a Racket expression has not been properly escaped within a Qi context, but in a special case where the Racket expression has the same name as a Qi form. In this instance, you may have used <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="RktPn">)</span> expecting to invoke Racket&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span> function, since <a href="Qi_Forms.html#%28part._.Identifiers%29" data-pltdoc="x">function identifiers may be used as flows directly</a> without needing to be escaped. But as Qi has a <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span> form as well, Qi&rsquo;s expander first attempts to match this against legitimate use of Qi&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span>, which fails, since this expects a flow as an argument and cannot be used in identifier form. To fix this in general, use an explicit <span class="RktSym">esc</span>, as in <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="RktPn">)</span><span class="RktPn">)</span>. In this specific case, you could also use Qi&rsquo;s <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktSym">NOT</span><span class="RktPn">)</span> instead.</p><p><span style="font-weight: bold">Common example</span>: Trying to use a Racket macro (rather than a function), or a macro from another DSL, as a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> without first registering it via <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span>. In general, Qi expects flows to be functions unless otherwise explicitly signaled.</p><h5 class="heading">8.2.4.5<tt>&nbsp;</tt><a name="(part._.Use_.Does_.Not_.Match_.Pattern)"></a>Use Does Not Match Pattern<span class="button-group"><a href="#(part._.Use_.Does_.Not_.Match_.Pattern)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">m:</span><span class="hspace">&nbsp;</span><span class="RktCmt">use</span><span class="hspace">&nbsp;</span><span class="RktCmt">does</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">match</span><span class="hspace">&nbsp;</span><span class="RktCmt">pattern:</span><span class="hspace">&nbsp;</span><span class="RktCmt">(m</span><span class="hspace">&nbsp;</span><span class="RktCmt">x</span><span class="hspace">&nbsp;</span><span class="RktCmt">y)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">in:</span><span class="hspace">&nbsp;</span><span class="RktCmt">m</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A macro was used in a way that doesn&rsquo;t match any declared syntax patterns.</p><p><span style="font-weight: bold">Common example</span>: Trying to use a Racket macro (rather than a function), or a macro from another DSL, as a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> without first registering it via <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span>. In general, Qi expects flows to be functions unless otherwise explicitly signaled.</p><h5 class="heading">8.2.4.6<tt>&nbsp;</tt><a name="(part._.Expected_.Identifier_.Not_.Starting_.With_.Character)"></a>Expected Identifier Not Starting With Character<span class="button-group"><a href="#(part._.Expected_.Identifier_.Not_.Starting_.With_.Character)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax-parser:</span><span class="hspace">&nbsp;</span><span class="RktCmt">expected</span><span class="hspace">&nbsp;</span><span class="RktCmt">identifier</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">starting</span><span class="hspace">&nbsp;</span><span class="RktCmt">with</span><span class="hspace">&nbsp;</span><span class="RktCmt">~</span><span class="hspace">&nbsp;</span><span class="RktCmt">character</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">at:</span><span class="hspace">&nbsp;</span><span class="RktCmt">~optional</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A macro attempted to use a <a href="http://pkg-build.racket-lang.org/doc/syntax/stxparse-patterns.html" data-pltdoc="x">syntax pattern</a> (which are commonly prefixed with the <span class="RktSym">~</span> character) but the parser thinks it&rsquo;s an identifier and doesn&rsquo;t like its name.</p><p><span style="font-weight: bold">Common example</span>: Syntax patterns are defined in the <a href="http://pkg-build.racket-lang.org/doc/syntax/stxparse.html" data-pltdoc="x">syntax/parse</a> library. If you are using them in Qi macros, you will need to <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span> at the appropriate phase level.</p><h5 class="heading">8.2.4.7<tt>&nbsp;</tt><a name="(part._.Identifier_s_.Binding_is_.Ambiguous)"></a>Identifier&rsquo;s Binding is Ambiguous<span class="button-group"><a href="#(part._.Identifier_s_.Binding_is_.Ambiguous)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">count:</span><span class="hspace">&nbsp;</span><span class="RktCmt">identifier's</span><span class="hspace">&nbsp;</span><span class="RktCmt">binding</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">ambiguous</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">in:</span><span class="hspace">&nbsp;</span><span class="RktCmt">count</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The <a href="http://pkg-build.racket-lang.org/doc/guide/Pairs__Lists__and_Racket_Syntax.html#%28tech._expander%29" class="techoutside" data-pltdoc="x"><span class="techinside">expander</span></a> attempted to resolve a <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28tech._reference%29" class="techoutside" data-pltdoc="x"><span class="techinside">reference</span></a> and found more than one possible <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28tech._binding%29" class="techoutside" data-pltdoc="x"><span class="techinside">binding</span></a>.</p><p><span style="font-weight: bold">Common example</span>: Having a Racket function in scope that has the same name as a Qi form, and attempting to use this <a href="Qi_Forms.html#%28part._.Identifiers%29" data-pltdoc="x">unqualified identifier</a> as a flow. To avoid the issue, rename the Racket function to something else, or use an explicit <span class="RktSym">esc</span> to indicate the Racket binding.</p><h5 class="heading">8.2.4.8<tt>&nbsp;</tt><a name="(part._.Not_.Defined_as_.Syntax_.Class)"></a>Not Defined as Syntax Class<span class="button-group"><a href="#(part._.Not_.Defined_as_.Syntax_.Class)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax-parser:</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">defined</span><span class="hspace">&nbsp;</span><span class="RktCmt">as</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax</span><span class="hspace">&nbsp;</span><span class="RktCmt">class</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">at:</span><span class="hspace">&nbsp;</span><span class="RktCmt">expr</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A macro attempted to use a <a href="http://pkg-build.racket-lang.org/doc/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28part._.Syntax_.Classes%29" data-pltdoc="x">syntax class</a> that the expander doesn&rsquo;t know about.</p><p><span style="font-weight: bold">Common example</span>: Common syntax classes are defined in the <a href="http://pkg-build.racket-lang.org/doc/syntax/stxparse.html" data-pltdoc="x">syntax/parse</a> library. If you are using them in Qi macros, you will need to <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span> at the appropriate phase level (e.g. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" class="RktStxLink" data-pltdoc="x">for-syntax</a></span><span class="stt"> </span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><h5 class="heading">8.2.4.9<tt>&nbsp;</tt><a name="(part._.Too_.Many_.Ellipses_in_.Template)"></a>Too Many Ellipses in Template<span class="button-group"><a href="#(part._.Too_.Many_.Ellipses_in_.Template)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax:</span><span class="hspace">&nbsp;</span><span class="RktCmt">too</span><span class="hspace">&nbsp;</span><span class="RktCmt">many</span><span class="hspace">&nbsp;</span><span class="RktCmt">ellipses</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">template</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">at:</span><span class="hspace">&nbsp;</span><span class="RktCmt">...</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A macro template attempted to refer to a syntax pattern matching many <a href="http://pkg-build.racket-lang.org/doc/reference/reader.html#%28tech._datum%29" class="techoutside" data-pltdoc="x"><span class="techinside">datums</span></a> but the parser claims there is no such pattern.</p><p><span style="font-weight: bold">Common example</span>: Attempting to use a syntax pattern like <span class="RktSym">...+</span> without requiring the <a href="http://pkg-build.racket-lang.org/doc/syntax/stxparse.html" data-pltdoc="x">syntax/parse</a> library. When writing Qi macros, you will often need <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" class="RktStxLink" data-pltdoc="x">for-syntax</a></span><span class="stt"> </span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span><span class="RktPn">)</span>, the same as when writing Racket macros.</p><h5 class="heading">8.2.4.10<tt>&nbsp;</tt><a name="(part._.Syntax__.Unbound_.Identifier)"></a>Syntax: Unbound Identifier<span class="button-group"><a href="#(part._.Syntax__.Unbound_.Identifier)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax:</span><span class="hspace">&nbsp;</span><span class="RktCmt">unbound</span><span class="hspace">&nbsp;</span><span class="RktCmt">identifier;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">also,</span><span class="hspace">&nbsp;</span><span class="RktCmt">no</span><span class="hspace">&nbsp;</span><span class="RktCmt">#%app</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax</span><span class="hspace">&nbsp;</span><span class="RktCmt">transformer</span><span class="hspace">&nbsp;</span><span class="RktCmt">is</span><span class="hspace">&nbsp;</span><span class="RktCmt">bound</span><span class="hspace">&nbsp;</span><span class="RktCmt">in</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">transformer</span><span class="hspace">&nbsp;</span><span class="RktCmt">phase</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: A macro attempted to manipulate a syntax object but the expander doesn&rsquo;t know what that even is.</p><p><span style="font-weight: bold">Common example</span>: When writing Qi macros, you will often need <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" class="RktStxLink" data-pltdoc="x">for-syntax</a></span><span class="stt"> </span><span class="RktSym">racket/base</span><span class="RktPn">)</span><span class="RktPn">)</span>, the same as when writing Racket macros.</p><h5 class="heading">8.2.4.11<tt>&nbsp;</tt><a name="(part._.Undefined)"></a>Undefined<span class="button-group"><a href="#(part._.Undefined)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">mac:</span><span class="hspace">&nbsp;</span><span class="RktCmt">undefined;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">cannot</span><span class="hspace">&nbsp;</span><span class="RktCmt">reference</span><span class="hspace">&nbsp;</span><span class="RktCmt">an</span><span class="hspace">&nbsp;</span><span class="RktCmt">identifier</span><span class="hspace">&nbsp;</span><span class="RktCmt">before</span><span class="hspace">&nbsp;</span><span class="RktCmt">its</span><span class="hspace">&nbsp;</span><span class="RktCmt">definition</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: An identifier appears unbound in your code.</p><p><span style="font-weight: bold">Common example</span>: Attempting to use a Qi macro in one module without <a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" data-pltdoc="x">providing</a> it from the module where it is defined &ndash; note that Qi macros must be provided as <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-space%29%29" class="RktStxLink" data-pltdoc="x">for-space</a></span><span class="stt"> </span><span class="RktSym">qi</span><span class="stt"> </span><span class="RktSym">mac</span><span class="RktPn">)</span><span class="RktPn">)</span>. See <a href="../../qi-doc/doc/qi/Qi_Macros.html#%28part._.Using_.Macros%29" data-pltdoc="x">Using Macros</a> for more on this.</p><h5 class="heading">8.2.4.12<tt>&nbsp;</tt><a name="(part._map_filter_.Contract_.Violation)"></a><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span>/<span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span> Contract Violation<span class="button-group"><a href="#(part._map_filter_.Contract_.Violation)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">map:</span><span class="hspace">&nbsp;</span><span class="RktCmt">contract</span><span class="hspace">&nbsp;</span><span class="RktCmt">violation</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">expected:</span><span class="hspace">&nbsp;</span><span class="RktCmt">procedure?</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">given:</span><span class="hspace">&nbsp;</span><span class="RktCmt">'(1</span><span class="hspace">&nbsp;</span><span class="RktCmt">2</span><span class="hspace">&nbsp;</span><span class="RktCmt">3)</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The interpreter attempted to apply a function to arguments but found that an argument was not of the expected type.</p><p><span style="font-weight: bold">Common example</span>: Using <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span> or <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span> without first <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktSym">qi/list</span><span class="RktPn">)</span>. The built-in Racket versions are <span class="emph">functions</span> that expect the input list argument at a specific position (i.e., on the right), whereas the Qi versions are <span class="emph">macros</span> that are invariant to threading direction and expect precisely one input &ndash; the list itself.</p><p><span style="font-weight: bold">Common example</span>: Using a nested flow (such as a <span class="RktSym">tee</span> junction or an <span class="RktSym">effect</span>) within a right-threading flow and assuming that the input arguments would be passed on the right. At the moment, Qi does not propagate the threading direction to nested clauses. You could either use a fresh right threading form or indicate the argument positions explicitly in the nested flow using an <a href="Qi_Forms.html#%28part._.Templates_and_.Partial_.Application%29" data-pltdoc="x">argument template</a>.</p><h5 class="heading">8.2.4.13<tt>&nbsp;</tt><a name="(part._.Compose__.Contract_.Violation)"></a>Compose: Contract Violation<span class="button-group"><a href="#(part._.Compose__.Contract_.Violation)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">compose:</span><span class="hspace">&nbsp;</span><span class="RktCmt">contract</span><span class="hspace">&nbsp;</span><span class="RktCmt">violation</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">expected:</span><span class="hspace">&nbsp;</span><span class="RktCmt">procedure?</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">given:</span><span class="hspace">&nbsp;</span><span class="RktCmt">'()</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The interpreter attempted to compose functions but encountered a value that was not a function.</p><p><span style="font-weight: bold">Common example</span>: Attempting to use <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span> as if it were a literal. Use <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> or <span class="RktPn">(</span><span class="RktSym">gen</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span><span class="RktPn">)</span> instead. See <a href="#%28part._null_is_.Not_a_.Literal%29" data-pltdoc="x">null is Not a Literal</a> for more.</p><h5 class="heading">8.2.4.14<tt>&nbsp;</tt><a name="(part._.List_.Arity_.Mismatch)"></a>List Arity Mismatch<span class="button-group"><a href="#(part._.List_.Arity_.Mismatch)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">list?:</span><span class="hspace">&nbsp;</span><span class="RktCmt">arity</span><span class="hspace">&nbsp;</span><span class="RktCmt">mismatch;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">expected</span><span class="hspace">&nbsp;</span><span class="RktCmt">number</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">arguments</span><span class="hspace">&nbsp;</span><span class="RktCmt">does</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">match</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">given</span><span class="hspace">&nbsp;</span><span class="RktCmt">number</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">expected:</span><span class="hspace">&nbsp;</span><span class="RktCmt">1</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">given:</span><span class="hspace">&nbsp;</span><span class="RktCmt">2</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The predicate <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list~3f%29%29" class="RktValLink" data-pltdoc="x">list?</a></span> was invoked, and it is complaining that it expects a single input argument but received many.</p><p><span style="font-weight: bold">Common example</span>: Attempting to separate multiple input values using <span class="RktSym">&#9651;</span>. This form separates a single input list into component values, and will produce the above error if it receives more than one input.</p><h5 class="heading">8.2.4.15<tt>&nbsp;</tt><a name="(part._.Fancy-app_.Arity_.Mismatch)"></a>Fancy-app Arity Mismatch<span class="button-group"><a href="#(part._.Fancy-app_.Arity_.Mismatch)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">.../fancy-app/main.rkt:28:19:</span><span class="hspace">&nbsp;</span><span class="RktCmt">arity</span><span class="hspace">&nbsp;</span><span class="RktCmt">mismatch;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">expected</span><span class="hspace">&nbsp;</span><span class="RktCmt">number</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">arguments</span><span class="hspace">&nbsp;</span><span class="RktCmt">does</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">match</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">given</span><span class="hspace">&nbsp;</span><span class="RktCmt">number</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">expected:</span><span class="hspace">&nbsp;</span><span class="RktCmt">2</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">given:</span><span class="hspace">&nbsp;</span><span class="RktCmt">1</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: Qi uses <a href="https://download.racket-lang.org/releases/8.17/doc/local-redirect/index.html?doc=fancy-app&amp;rel=index.html" class="Sq" data-pltdoc="x">fancy-app</a> to handle <a href="Qi_Forms.html#%28part._.Templates_and_.Partial_.Application%29" data-pltdoc="x">partial application templates</a>. Fancy-app is complaining that it was told to expect a certain number of arguments in the function invocation but received a different number.</p><p><span style="font-weight: bold">Common example</span>: You have a template like <span class="RktPn">(</span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span> with a certain number of arguments indicated, but it was invoked with more or fewer arguments.</p><h5 class="heading">8.2.4.16<tt>&nbsp;</tt><a name="(part._.Application__.Not_a_.Procedure)"></a>Application: Not a Procedure<span class="button-group"><a href="#(part._.Application__.Not_a_.Procedure)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">application:</span><span class="hspace">&nbsp;</span><span class="RktCmt">not</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">procedure;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">expected</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">procedure</span><span class="hspace">&nbsp;</span><span class="RktCmt">that</span><span class="hspace">&nbsp;</span><span class="RktCmt">can</span><span class="hspace">&nbsp;</span><span class="RktCmt">be</span><span class="hspace">&nbsp;</span><span class="RktCmt">applied</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">arguments</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">given:</span><span class="hspace">&nbsp;</span><span class="RktCmt">5</span><span class="RktMeta"></span></td></tr></table></blockquote><p><span style="font-weight: bold">Meaning</span>: The interpreter attempted to invoke a function but it found something other than a function (in this case, the value <span class="RktVal">5</span>).</p><p><span style="font-weight: bold">Common example</span>: Attempting to partially apply a function with the same name as a Qi form, for instance, using a <a href="http://pkg-build.racket-lang.org/doc/guide/let.html#%28part._.Named_let%29" data-pltdoc="x">Named <span class="RktSym"><span class="RktStxLink">let</span></span></a> with the name <span class="RktSym">loop</span> and attempting to partially apply the recursive invocation using Qi. Since <span class="RktSym">loop</span> is the name of a Qi form, in order to use the Racket function in scope, you need to either use <span class="RktSym">esc</span> or rename the function (in the case of <span class="RktSym">loop</span>, consider <span class="RktSym">go</span> instead) to avoid the collision.</p><h5 class="heading">8.2.5<tt>&nbsp;</tt><a name="(part._.Gotchas)"></a>Gotchas<span class="button-group"><a href="#(part._.Gotchas)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><h5 class="heading">8.2.5.1<tt>&nbsp;</tt><a name="(part._null_is_.Not_a_.Literal)"></a>null is Not a Literal<span class="button-group"><a href="#(part._null_is_.Not_a_.Literal)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>In Racket, <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span> is another way to indicate the empty list <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>, so that <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span> and <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> are typically interchangeable. But note that <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> is a <a href="http://pkg-build.racket-lang.org/doc/reference/quote.html" data-pltdoc="x">literal</a>, while <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span> is an <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28tech._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">identifier</span></a> whose value is <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>. Therefore, as <a href="Qi_Forms.html#%28part._.Literals%29" data-pltdoc="x">Qi interprets literals</a> as functions generating them, <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> in Qi is treated as a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> that produces the value <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>. On the other hand, as <a href="Qi_Forms.html#%28part._.Identifiers%29" data-pltdoc="x">Qi expects identifiers to be function-valued</a>, and as <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span> isn&rsquo;t a function, using it on its own is an error.</p><h5 class="heading">8.2.5.2<tt>&nbsp;</tt><a name="(part._.There_s_.No_.Escaping_esc)"></a>There&rsquo;s No Escaping <span class="RktSym">esc</span><span class="button-group"><a href="#(part._.There_s_.No_.Escaping_esc)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>If you have a function that returns another function that you&rsquo;d like to use as a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> (e.g. perhaps parametrized by the first function over some argument), the usual way to do it is something like this:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">get-f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>But in an idle moment, this clever shortcut may tempt you:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">get-f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>That is, since Qi typically interprets parenthesized expressions as <a href="Qi_Forms.html#%28part._.Templates_and_.Partial_.Application%29" data-pltdoc="x">partial application templates</a>, you might expect that this would pass the value <span class="RktVal">3</span> to the function resulting from <span class="RktPn">(</span><span class="RktSym">get-f</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span>. In fact, that isn&rsquo;t what happens, and an error is raised instead. As there is only one datum within the outer pair of parentheses in <span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">get-f</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span>, the usual interpretation as partial application would not typically be useful, so Qi opts to treat it as invalid syntax.</p><p>One way to dodge this is by using an explicit template:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">get-f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>This works in most cases, but it has different semantics than the version using <span class="RktSym">esc</span>, as that version evaluates the escaped expression first to yield the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> that will be applied to inputs, while this one only evaluates the (up to that point, incomplete) expression when it is actually invoked with arguments. In the most common cases there will be no difference to the result, but if the flow is invoked multiple times (for instance, if it were first defined as <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span><span class="stt"> </span><span class="RktSym">my-flow</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">get-f</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>), then the expression too would be evaluated multiple times, producing different functions each time. This may be computationally more expensive than using <span class="RktSym">esc</span>, and also, if either <span class="RktSym">get-f</span> or the function it produces is stateful in any way (for instance, if it is a <a href="https://www.gnu.org/software/guile/manual/html_node/Closure.html">closure</a> or if there is any randomness involved), then this version would also produce different results than the <span class="RktSym">esc</span> version.</p><p>So in sum, it&rsquo;s perhaps best to rely on <span class="RktSym">esc</span> in such cases to be as explicit as possible about what you mean, rather than rely on quirks of the implementation that are revealed at this boundary between two languages.</p><h5 class="heading">8.2.5.3<tt>&nbsp;</tt><a name="(part._.Mutable_.Values_.Defy_the_.Laws_of_.Flows)"></a>Mutable Values Defy the Laws of Flows<span class="button-group"><a href="#(part._.Mutable_.Values_.Defy_the_.Laws_of_.Flows)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Qi is designed to model flows of <span class="emph">immutable</span> values. Using a mutable value in a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> is fine as long as you don&rsquo;t mutate it, or if you mutate it only in a side effect. Otherwise, such values can produce unexpected behavior. For instance, consider the following flow involving a mutable vector:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">vv</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">vv</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-set%21%29%29" class="RktValLink" data-pltdoc="x">vector-set!</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-set%21%29%29" class="RktValLink" data-pltdoc="x">vector-set!</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28lib._racket%2Fvector..rkt%29._vector-append%29%29" class="RktValLink" data-pltdoc="x">vector-append</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p>You might expect this flow to produce a vector <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span><span class="stt"> </span><span class="RktVal">5</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span>, but in fact, it raises an error.</p><p>This is because <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-set%21%29%29" class="RktValLink" data-pltdoc="x">vector-set!</a></span> mutates the vector and produces not the result of the operation but <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span>, since the mutation that is the intent of the function has been performed and there is no need to produce a fresh value. Indeed, mutating interfaces typically produce <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span>, which is not a useful value that could be used in a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>. As a result, the output of the relay is two values, but not the ones we expect, but rather, values that are both <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span>. These are received by <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28lib._racket%2Fvector..rkt%29._vector-append%29%29" class="RktValLink" data-pltdoc="x">vector-append</a></span>, which then complains that it expects vectors but was given <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span>.</p><p>Worse still, even though this computation raises an error, we find that the original vector that we started with, <span class="RktSym">vv</span>, has been mutated to <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span><span class="stt"> </span><span class="RktVal">5</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">10</span><span class="RktPn">)</span>, since the same vector is operated on in both channels of the relay prior to the error being encountered.</p><p>So in general, use mutable values with caution. Such values can be useful as side effects, for instance to capture some idea of statefulness, perhaps keeping track of the number of times a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> was invoked. But they should generally not be used as inputs to a flow, especially if they are to be mutated.</p><h5 class="heading">8.2.5.4<tt>&nbsp;</tt><a name="(part._.Order_of_.Effects)"></a>Order of Effects<span class="button-group"><a href="#(part._.Order_of_.Effects)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Qi <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flows</span></a> may exhibit a different order of effects (in the <a href="#%28part._.Separate_.Effects_from_.Other_.Computations%29" data-pltdoc="x">functional programming sense</a>) than equivalent Racket functions.</p><p>Consider the Racket expression: <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._odd~3f%29%29" class="RktValLink" data-pltdoc="x">odd?</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">4</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>. As this invokes <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._odd~3f%29%29" class="RktValLink" data-pltdoc="x">odd?</a></span> on all of the elements of the input list, followed by <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span> on all of the elements of the intermediate list, if we imagine that <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._odd~3f%29%29" class="RktValLink" data-pltdoc="x">odd?</a></span> and <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span> print their inputs as a side effect before producing their results, then executing this program would print the numbers in the sequence <span class="RktVal">1</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">2</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">3</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">4</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">5</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">3</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">5</span>.</p><p>The equivalent Qi flow is <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">4</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._filter%29%29" class="RktValLink" data-pltdoc="x">filter</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._odd~3f%29%29" class="RktValLink" data-pltdoc="x">odd?</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="RktPn">)</span><span class="RktPn">)</span>. As this sequence is <a href="When_Should_I_Use_Qi_.html#%28part._.Don_t_.Stop_.Me_.Now%29" data-pltdoc="x">deforested by Qi&rsquo;s compiler</a> to avoid multiple passes over the data and the memory overhead of intermediate representations, it invokes the functions in sequence <span class="emph">on each element</span> rather than <span class="emph">on all of the elements of each list in turn</span>. The printed sequence with Qi would be <span class="RktVal">1</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">2</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">3</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">3</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">4</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">5</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktVal">5</span>.</p><p>Yet, either implementation produces the same output: <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">9</span><span class="stt"> </span><span class="RktVal">25</span><span class="RktPn">)</span>.</p><p>So, to reiterate, while the behavior of <span class="emph">pure</span> Qi flows will be the same as that of equivalent Racket expressions, effectful flows may exhibit a different order of effects. In the case where the output of such effectful flows is dependent on those effects (such as relying on a mutable global variable), these flows could even produce different output than otherwise equivalent (from the perspective of inputs and outputs, disregarding effects) Racket code.</p><p>If you&rsquo;d like to use Racket&rsquo;s order of effects in any flow, <a href="Language_Interface.html#%28part._.Using_.Racket_to_.Define_.Flows%29" data-pltdoc="x">write the flow in Racket</a> by using a wrapping <span class="RktSym">esc</span>.</p><h4 class="heading">8.3<tt>&nbsp;</tt><a name="(part._.Effectively_.Using_.Feedback_.Loops)"></a>Effectively Using Feedback Loops<span class="button-group"><a href="#(part._.Effectively_.Using_.Feedback_.Loops)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><p><span class="RktSym">feedback</span> is Qi&rsquo;s most powerful looping form, useful for arbitrary recursion. As it encourages quite a different way of thinking than Racket&rsquo;s usual looping forms do, here are some tips on "grokking" it.</p><p>In essence, the feedback loop is very simple &#8211;- all it does is pass the same inputs through a <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> over and over again until a condition is met, at which point these inputs just flow out of the loop. Nothing complicated at all! The subtlety comes in, though, when we treat some inputs as "control" inputs that determine attributes <span class="emph">of</span> the flow or as "scratch" inputs that encode computations done <span class="emph">on</span> the flow, while treating the remaining inputs as the data that are actually acted upon. By doing this, we can do pretty much anything we&rsquo;d like to, i.e. it can be used for general recursion.</p><h5 class="heading">8.3.1<tt>&nbsp;</tt><a name="(part._.Control_.Values_and_.Data_.Values)"></a>Control Values and Data Values<span class="button-group"><a href="#(part._.Control_.Values_and_.Data_.Values)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Prior to entering the feedback loop, augment the data values by starting "channels" (that is, simply input values passed at a specific index to the feedback <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>) for control or scratch values that the loop will need (although control and scratch inputs are not <span class="emph">quite</span> the same (see above), we can use the terms interchangeably for our purposes here). In some common cases, this may include a counter channel which keeps track of number of iterations, a result channel which accumulates an output, or something of this nature. In addition to these control channels, the loop will, of course, also receive all of the input data in the form of multiple values following the control values. The control inputs must always come first, so that we know where to find them (since we have no idea how many data values there will be at any stage of the loop), so that we can consistently refer to them using e.g. <span class="RktSym">1&gt;</span> and <span class="RktSym">2&gt;</span>.</p><h5 class="heading">8.3.2<tt>&nbsp;</tt><a name="(part._.Input_.Tracing)"></a>Input Tracing<span class="button-group"><a href="#(part._.Input_.Tracing)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>For each input, think about just one cycle of the loop: what must happen to it in this cycle before it is fed forward to the next cycle of the loop? Trace each input in this way and ensure that the corresponding output of the present cycle represents the correct input value for the next cycle. For instance, if there is a simple counter in the first <span class="emph">input</span> position, ensure that the first <span class="emph">output</span> of the present cycle is the counter incremented by one. We also need to ensure that the same number of <span class="emph">control</span> values flow to the next cycle as are used in the present cycle. There are no constraints on the number of data values, and often, this will change from one cycle to the next.</p><h5 class="heading">8.3.3<tt>&nbsp;</tt><a name="(part._.Keeping_.It_.Tidy)"></a>Keeping It Tidy<span class="button-group"><a href="#(part._.Keeping_.It_.Tidy)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Use the <span class="RktSym">then</span> clause to ensure that the feedback loop produces only its computed output and not the "scratch" values used in guiding the <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>, i.e., these should be blocked in the <span class="RktSym">then</span> clause (using, for instance, <span class="RktSym">block</span> or another appropriate form).</p><h4 class="heading">8.4<tt>&nbsp;</tt><a name="(part._.Idioms_and_.Transforms)"></a>Idioms and Transforms<span class="button-group"><a href="#(part._.Idioms_and_.Transforms)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><h5 class="heading">8.4.1<tt>&nbsp;</tt><a name="(part._.Nested_.Applications_are_.Sequential_.Flows)"></a>Nested Applications are Sequential Flows<span class="button-group"><a href="#(part._.Nested_.Applications_are_.Sequential_.Flows)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A nested function application can always be converted to a sequential <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">51</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">51</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-num</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-num</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-num</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">321</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-num</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" class="RktValLink" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">321</span></p></td></tr></table></blockquote></div></p><h5 class="heading">8.4.2<tt>&nbsp;</tt><a name="(part._.Converting_a_.Function_to_a_.Closure)"></a>Converting a Function to a Closure<span class="button-group"><a href="#(part._.Converting_a_.Function_to_a_.Closure)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><h5 class="heading">8.4.2.1<tt>&nbsp;</tt><a name="(part._.Basic_.Recipe)"></a>Basic Recipe<span class="button-group"><a href="#(part._.Basic_.Recipe)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Sometimes you may find you want to go from something like <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktSym">f1</span><span class="stt"> </span><span class="RktSym">f2</span><span class="RktPn">)</span> to a similar <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> except that one of the functions is itself parameterized by an input, i.e. it is a closure. If <span class="RktSym">f1</span> is the one that needs to be a closure, you can do it like this: <span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">==*</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">clos</span><span class="stt"> </span><span class="RktSym">f1</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="stt"> </span><span class="RktSym">f2</span><span class="RktPn">)</span>, assuming that the closed-over argument to <span class="RktSym">f1</span> is passed in as the first input, and the remaining inputs are the data inputs to the flow. Closures are useful in a wide variety of situations, however, and this isn&rsquo;t a one-size-fits-all formula.</p><h5 class="heading">8.4.2.2<tt>&nbsp;</tt><a name="(part._.Definition_vs_.Invocation_.Inputs)"></a>Definition vs Invocation Inputs<span class="button-group"><a href="#(part._.Definition_vs_.Invocation_.Inputs)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> defined using <span class="RktSym">clos</span> retains all of the inputs from the definition site when it is applied at the invocation site. Referring to inputs within the flow definition thus means these combined "definition site + invocation site" inputs (in that order, unless modulated by a containing threading form), <span class="emph">not</span> the inputs available at the definition site alone. So for instance, if you only need access to a subset of definition-site inputs rather than all of them, these should be filtered prior to passing them in to <span class="RktSym">clos</span> as, otherwise, you would unwittingly be filtering out invocation site inputs too. The following example illustrates this.</p><p>If you are interested in creating a <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span>-derived function that prepends a prefix to an input, where the prefix is itself determined at runtime, you might attempt it this way:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">"prefix-"</span><span class="hspace">&nbsp;</span><span class="RktVal">"something"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">clos</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">1&gt;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">2&gt;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"prefix-"</span></p></td></tr></table></blockquote><p>... but this does not produce the expected output for the aforementioned reason, that the body of the <span class="RktSym">clos</span> form refers to the inputs ("prefix-", "something", "something"), so that selecting the first one with <span class="RktSym">1&gt;</span> means there is only one input being passed to <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span> in producing the result. Instead, the following is what we want:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">"prefix-"</span><span class="hspace">&nbsp;</span><span class="RktVal">"something"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym">1&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">clos</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">2&gt;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"prefix-something"</span></p></td></tr></table></blockquote><p>Of course, in this particular example, using a <span class="RktSym">relay</span> instead of a <span class="RktSym">tee</span> junction would avoid the issue altogether.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">"prefix-"</span><span class="hspace">&nbsp;</span><span class="RktVal">"something"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">clos</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" class="RktValLink" data-pltdoc="x">string-append</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">"prefix-something"</span></p></td></tr></table></blockquote><h5 class="heading">8.4.3<tt>&nbsp;</tt><a name="(part._.Converting_a_.Macro_to_a_.Flow)"></a>Converting a Macro to a Flow<span class="button-group"><a href="#(part._.Converting_a_.Macro_to_a_.Flow)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Flows are expected to be <a href="Principles_of_Qi.html#%28part._.What_is_a_.Flow_%29" data-pltdoc="x">function-valued</a> at runtime, and so you cannot naively use a macro as a flow. You can always convert a macro into a function by employing an <span class="RktSym">esc</span> form and wrapping the macro in a lambda.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">double-me</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">double-me</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">eval:15:0: double-me: use does not match pattern: (double-me</span></p></td></tr><tr><td><p><span class="RktErr">x)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: double-me</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subtract-two</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">esc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">double-me</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><p>But this can be cumbersome for anything other than a one-off use of a macro, and it also doesn&rsquo;t take advantage of the syntactic conveniences (such as templates) that Qi already offers. You could write Qi macros to wrap these "foreign" macros and provide all of Qi&rsquo;s usual syntactic behavior, but luckily, you don&rsquo;t need to! Simply use <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span> to "register" any such foreign macros (i.e. macros in any language other than Qi, including Racket) as Qi forms, and then you can use them in the same way as any other function, except that the catch-all <span class="RktVar">__</span> template isn&rsquo;t supported.</p><p>Using this approach, you would need to register each such foreign macro using <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-qi-foreign-syntaxes%29%29" class="RktStxLink" data-pltdoc="x">define-qi-foreign-syntaxes</a></span> prior to use. Even though you can register as many as you like with a single declaration, this may feel like an impedance, especially for deep integrations with other DSLs where there may be a large number of such forms. See <a href="Language_Interface.html#%28part._.Qi_.Dialect_.Interop%29" data-pltdoc="x">Writing a Qi Dialect</a> for yet another approach.</p><h5 class="heading">8.4.4<tt>&nbsp;</tt><a name="(part._.Bindings_are_an_.Alternative_to_.Nonlinearity)"></a>Bindings are an Alternative to Nonlinearity<span class="button-group"><a href="#(part._.Bindings_are_an_.Alternative_to_.Nonlinearity)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>In some cases, we&rsquo;d prefer to think of a nonlinear <a href="Principles_of_Qi.html#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a> as a linear sequence on a subset of arguments that happens to need the remainder of the arguments somewhere down the line. In such cases, it is advisable to employ <a href="Qi_Forms.html#%28part._.Binding%29" data-pltdoc="x">bindings</a> so that the flow can be defined on this subset of them and employ the remainder by name.</p><p>For example, for a function called <span class="RktSym">make-document</span> accepting two arguments that are the name of the document and a file object, these implementations are equivalent:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">make-document</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;&gt;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">file-contents</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse-result</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">document/p</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#9651;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">document</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._define-flow%29%29" class="RktStxLink" data-pltdoc="x">define-flow</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">make-document</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;&gt;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">as</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">file-contents</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse-result</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">document/p</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#9651;</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">document</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">name</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Adding bindings can eliminate nonlinearities, and by the same token, introducing nonlinearity can eliminate bindings.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Qi_Macros.html" title="backward to &quot;7 Qi Macros&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: An Embeddable Flow-Oriented Language&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Principles_of_Qi.html" title="forward to &quot;9 Principles of Qi&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>