<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>9&nbsp;Principles of Qi</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {document.write('<scr' + 'ipt type="text/javascript" src="MathJax/MathJax.js?config=default"></scr' + 'ipt>');})();
</script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Qi:<span class="mywbr"> &nbsp;</span> An Embeddable Flow-<wbr></wbr>Oriented Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Using_These_Docs.html" class="tocviewlink" data-pltdoc="x">Using These Docs</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Introduction_and_Usage.html" class="tocviewlink" data-pltdoc="x">Introduction and Usage</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Tutorial.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Language_Interface.html" class="tocviewlink" data-pltdoc="x">Language Interface</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Qi_Forms.html" class="tocviewlink" data-pltdoc="x">The Qi Language</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="List_Operations.html" class="tocviewlink" data-pltdoc="x">List Operations</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Qi_Macros.html" class="tocviewlink" data-pltdoc="x">Qi Macros</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Field_Guide.html" class="tocviewlink" data-pltdoc="x">Field Guide</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Principles of Qi</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="When_Should_I_Use_Qi_.html" class="tocviewlink" data-pltdoc="x">When Should I Use Qi?</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Flowing_with_the_Flow.html" class="tocviewlink" data-pltdoc="x">Input Methods</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>9&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Principles of Qi</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">9.1&nbsp;</td><td><a href="#%28part._.What_is_a_.Flow_%29" class="tocviewlink" data-pltdoc="x">What is a Flow?</a></td></tr><tr><td align="right">9.2&nbsp;</td><td><a href="#%28part._.Values_and_.Flows%29" class="tocviewlink" data-pltdoc="x">Values and Flows</a></td></tr><tr><td align="right">9.3&nbsp;</td><td><a href="#%28part._.Flows_as_.Graphs%29" class="tocviewlink" data-pltdoc="x">Flows as Graphs</a></td></tr><tr><td align="right">9.4&nbsp;</td><td><a href="#%28part._.Values_are_.Not_.Collections%29" class="tocviewlink" data-pltdoc="x">Values are Not Collections</a></td></tr><tr><td align="right">9.5&nbsp;</td><td><a href="#%28part._.Everything_is_a_.Function%29" class="tocviewlink" data-pltdoc="x">Counting Flows</a></td></tr><tr><td align="right">9.6&nbsp;</td><td><a href="#%28part._.Flowy_.Logic%29" class="tocviewlink" data-pltdoc="x">Flowy Logic</a></td></tr><tr><td align="right">9.7&nbsp;</td><td><a href="#%28part._.Phrases%29" class="tocviewlink" data-pltdoc="x">Phrases</a></td></tr><tr><td align="right">9.8&nbsp;</td><td><a href="#%28part._.Identities%29" class="tocviewlink" data-pltdoc="x">Identities</a></td></tr><tr><td align="right">9.9&nbsp;</td><td><a href="#%28part._.Flows_and_.Arrows%29" class="tocviewlink" data-pltdoc="x">Flows and Arrows</a></td></tr><tr><td align="right">9.10&nbsp;</td><td><a href="#%28part._.It_s_.Languages_.All_the_.Way_.Down%29" class="tocviewlink" data-pltdoc="x">It&rsquo;s Languages All the Way Down</a></td></tr><tr><td align="right">9.11&nbsp;</td><td><a href="#%28part._.The_.Qi_.Core_.Language%29" class="tocviewlink" data-pltdoc="x">The Qi Core Language</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">9.1<tt>&nbsp;</tt></span><a href="#%28part._.What_is_a_.Flow_%29" class="tocsubseclink" data-pltdoc="x">What is a Flow?</a></td></tr><tr><td><span class="tocsublinknumber">9.2<tt>&nbsp;</tt></span><a href="#%28part._.Values_and_.Flows%29" class="tocsubseclink" data-pltdoc="x">Values and Flows</a></td></tr><tr><td><span class="tocsublinknumber">9.3<tt>&nbsp;</tt></span><a href="#%28part._.Flows_as_.Graphs%29" class="tocsubseclink" data-pltdoc="x">Flows as Graphs</a></td></tr><tr><td><span class="tocsublinknumber">9.4<tt>&nbsp;</tt></span><a href="#%28part._.Values_are_.Not_.Collections%29" class="tocsubseclink" data-pltdoc="x">Values are Not Collections</a></td></tr><tr><td><span class="tocsublinknumber">9.5<tt>&nbsp;</tt></span><a href="#%28part._.Everything_is_a_.Function%29" class="tocsubseclink" data-pltdoc="x">Counting Flows</a></td></tr><tr><td><span class="tocsublinknumber">9.6<tt>&nbsp;</tt></span><a href="#%28part._.Flowy_.Logic%29" class="tocsubseclink" data-pltdoc="x">Flowy Logic</a></td></tr><tr><td><span class="tocsublinknumber">9.7<tt>&nbsp;</tt></span><a href="#%28part._.Phrases%29" class="tocsubseclink" data-pltdoc="x">Phrases</a></td></tr><tr><td><span class="tocsublinknumber">9.8<tt>&nbsp;</tt></span><a href="#%28part._.Identities%29" class="tocsubseclink" data-pltdoc="x">Identities</a></td></tr><tr><td><span class="tocsublinknumber">9.9<tt>&nbsp;</tt></span><a href="#%28part._.Flows_and_.Arrows%29" class="tocsubseclink" data-pltdoc="x">Flows and Arrows</a></td></tr><tr><td><span class="tocsublinknumber">9.10<tt>&nbsp;</tt></span><a href="#%28part._.It_s_.Languages_.All_the_.Way_.Down%29" class="tocsubseclink" data-pltdoc="x">It&rsquo;s Languages All the Way Down</a></td></tr><tr><td><span class="tocsublinknumber">9.11<tt>&nbsp;</tt></span><a href="#%28part._.The_.Qi_.Core_.Language%29" class="tocsubseclink" data-pltdoc="x">The Qi Core Language</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Field_Guide.html" title="backward to &quot;8 Field Guide&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: An Embeddable Flow-Oriented Language&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="When_Should_I_Use_Qi_.html" title="forward to &quot;10 When Should I Use Qi?&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h3 class="heading">9<tt>&nbsp;</tt><a name="(part._.Principles_of_.Qi)"></a>Principles of Qi<span class="button-group"><a href="#(part._.Principles_of_.Qi)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>After many patient hours meticulously crafting Qi flows, you may find that you seek a deeper understanding; insight into guiding principles and inner workings, so that you can hone your skills on firmer ground.</p><p>Welcome. Your wanderings have brought you to the right place. In this chapter, we discuss various topics that will help you have a fuller understanding and a sound conceptual model of how Qi works. This kind of facility with the fundamentals will be useful as you employ Qi for more complex tasks, enabling you to engage in higher level reasoning about the task at hand rather than be mired in conceptual building blocks.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.What_is_a_.Flow_%29" class="toclink" data-pltdoc="x">9.1<span class="hspace">&nbsp;</span>What is a Flow?</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Values_and_.Flows%29" class="toclink" data-pltdoc="x">9.2<span class="hspace">&nbsp;</span>Values and Flows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Flows_as_.Graphs%29" class="toclink" data-pltdoc="x">9.3<span class="hspace">&nbsp;</span>Flows as Graphs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Values_are_.Not_.Collections%29" class="toclink" data-pltdoc="x">9.4<span class="hspace">&nbsp;</span>Values are Not Collections</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Everything_is_a_.Function%29" class="toclink" data-pltdoc="x">9.5<span class="hspace">&nbsp;</span>Counting Flows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Flowy_.Logic%29" class="toclink" data-pltdoc="x">9.6<span class="hspace">&nbsp;</span>Flowy Logic</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Phrases%29" class="toclink" data-pltdoc="x">9.7<span class="hspace">&nbsp;</span>Phrases</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Identities%29" class="toclink" data-pltdoc="x">9.8<span class="hspace">&nbsp;</span>Identities</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Flows_and_.Arrows%29" class="toclink" data-pltdoc="x">9.9<span class="hspace">&nbsp;</span>Flows and Arrows</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.It_s_.Languages_.All_the_.Way_.Down%29" class="toclink" data-pltdoc="x">9.10<span class="hspace">&nbsp;</span>It&rsquo;s Languages All the Way Down</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.The_.Qi_.Core_.Language%29" class="toclink" data-pltdoc="x">9.11<span class="hspace">&nbsp;</span>The Qi Core Language</a></p></td></tr></table><h4 class="heading">9.1<tt>&nbsp;</tt><a name="(part._.What_is_a_.Flow_)"></a>What is a Flow?<span class="button-group"><a href="#(part._.What_is_a_.Flow_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>A <a name="(tech._flow)"></a><span style="font-style: italic">flow</span> is either composed of flows, or is a native (e.g. Racket) <a href="http://pkg-build.racket-lang.org/doc/guide/lambda.html" data-pltdoc="x">function</a>. In the former case, the composite flow is made up of flows that are combined in <a href="Qi_Forms.html" data-pltdoc="x">well-defined structural ways</a> specifying the role of each component flow.</p><p>A flow in general accepts <span class="RktSym">m</span><span class="RktMeta"></span> inputs and yields <span class="RktSym">n</span><span class="RktMeta"></span> outputs, for arbitrary non-negative integers <span class="RktSym">m</span><span class="RktMeta"></span> and <span class="RktSym">n</span><span class="RktMeta"></span>. We say that such a flow is <span class="RktSym">m</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#215;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">n</span><span class="RktMeta"></span>.</p><p>Flows are <a href="Qi_Macros.html#%28part._.Embedding_a_.Hosted_.Language%29" data-pltdoc="x">embedded</a> into the host language (e.g. Racket) using the <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~e2~98~af%29%29" class="RktStxLink" data-pltdoc="x">&#9775;</a></span> macro which evaluates to an ordinary function. To use the flow, simply invoke this function with inputs as ordinary arguments to obtain the outputs as ordinary return values.</p><p>The Qi language allows you to describe and use flows in your code.</p><h4 class="heading">9.2<tt>&nbsp;</tt><a name="(part._.Values_and_.Flows)"></a>Values and Flows<span class="button-group"><a href="#(part._.Values_and_.Flows)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><a href="#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">Flows</span></a> accept inputs and produce outputs &ndash; they are functions. The things that flow &ndash; the inputs and outputs &ndash; are <span class="emph">values</span>. Yet, values do not actually "move" through a flow, since a flow does not mutate them. The flow simply produces new values that are related to the inputs by a computation.</p><p>Every flow is made up of components that are themselves flows. Thus, each of these components is a relationship between an input set of values and an output set of values, so that at every level, flows produce sequences of sets of values beginning with the inputs and ending with the outputs, with each set related to the preceding one by a computation, and again, no real "motion" of values at all.</p><p>So indeed, when we say that values "flow," there is nothing in fact that truly flows, and it is merely a convenient metaphor.</p><h4 class="heading">9.3<tt>&nbsp;</tt><a name="(part._.Flows_as_.Graphs)"></a>Flows as Graphs<span class="button-group"><a href="#(part._.Flows_as_.Graphs)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>A flow could also be considered an <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">acyclic graph</a>, with its component flows as nodes, and a directed edge connecting two flows if an output of one is used as an input of the other. There may be many distinct <a name="(tech._path)"></a><span style="font-style: italic">paths</span> that could be traced over this graph, and we may imagine values to flow along these paths at runtime (although of course, <a href="#%28part._.Values_and_.Flows%29" data-pltdoc="x">there is nothing that flows</a>). At each point in the flow (in this spatial sense), there are a certain number of values present, depending on the runtime inputs. We refer to this number as the <a name="(tech._arity)"></a><span style="font-style: italic">arity</span> or the <a name="(tech._volume)"></a><span style="font-style: italic">volume</span> of the flow at that point. Volume is a runtime concept since it depends on the actual inputs provided to the flow, although there may be cases where it could be determined at compile time.</p><h4 class="heading">9.4<tt>&nbsp;</tt><a name="(part._.Values_are_.Not_.Collections)"></a>Values are Not Collections<span class="button-group"><a href="#(part._.Values_are_.Not_.Collections)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The things that flow are values. Individual values may happen to be collections such as lists, but the values that are flowing are not, together, a collection of any kind.</p><p>To understand this with an example: when we employ a tee junction in a <a href="#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flow</span></a>, colloquially, we might say that the junction "divides the flow into two," which might suggest that there are now two flows. But in fact, there is just one flow that divides <span class="emph">values</span> down two separate flows which are part of its makeup. More precisely, <span class="RktSym"><span class="nobreak">-&lt;</span></span> composes two flows to yield a single composite flow. Like any flow, this composite flow accepts values and produces values, not collections of values. There is no way to differentiate, at the output end, which values came from the first channel of the junction and which ones came from the second, since downstream flows have no idea about the structure of upstream flows and only see the values they receive.</p><p>The way to group values, if we need grouping, is to collect them into a data structure (e.g. a list) using a collection prism, <span class="RktSym">&#9661;</span>. In the case of a tee junction, the way to differentiate between values coming from each channel of the junction is for the channels to individually <span class="RktSym">collect</span> their values at the end. That way, the values that are the output of the composite flow are lists generated individually by the various channels of the flow.</p><h4 class="heading">9.5<tt>&nbsp;</tt><a name="(part._.Everything_is_a_.Function)"></a>Counting Flows<span class="button-group"><a href="#(part._.Everything_is_a_.Function)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Everything in Qi is a <a href="http://pkg-build.racket-lang.org/doc/guide/lambda.html" data-pltdoc="x">function</a>. Programs are functions, they are made up of functions. Even <a href="Qi_Forms.html#%28part._.Literals%29" data-pltdoc="x">literals</a> are interpreted as functions generating them.</p><p>Consider this example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fmath..rkt%29._sqr%29%29" class="RktValLink" data-pltdoc="x">sqr</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" class="RktValLink" data-pltdoc="x">*</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>There are six <a href="#%28tech._flow%29" class="techoutside" data-pltdoc="x"><span class="techinside">flows</span></a> here, in all: the entire one, each component of the thread, and each component of the tee junction.</p><h4 class="heading">9.6<tt>&nbsp;</tt><a name="(part._.Flowy_.Logic)"></a>Flowy Logic<span class="button-group"><a href="#(part._.Flowy_.Logic)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Qi&rsquo;s design is inspired by buddhist &#347;&#363;nyat&#257; logic. To understand it holistically would require a history lesson to put the sunyata development in context, and that would be quite a digression. But in essence, sunyata is about transcension of context or viewpoint. A viewpoint is identifiable with a logical span of possibilities (<span class="emph">catu&#7779;ko&#7789;i</span>) in terms of which assertions may be made. Sunyata is the rejection of <span class="emph">all</span> of the available logical possibilities, thus transcending the very framing of the problem (this is signified by the word <span class="emph">mu</span> in Zen). This kind of transcension could suggest alternative points of view, but more precisely, does not indicate a point of view (which isn&rsquo;t the same as being ambivalent or even agnostic). This idea has implications not just for formal logical systems but also for everyday experience and profound metaphysical questions alike.</p><p>But for the purposes of Qi, what it means is that the existence of a value is a logical span within which it takes on specific forms. Sunyata is the difference between a value taking on a form indicating tangible output (e.g. <span class="RktVal">5</span> or <span class="RktVal">"hello"</span>) or indicating absence (e.g. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" class="RktValLink" data-pltdoc="x">void</a></span><span class="RktPn">)</span> or <span class="RktVal">""</span>) or failure (e.g. <span class="RktVal">#f</span>), or provisionality (e.g. <span class="RktVal">'</span><span class="RktVal">suspended</span>) or certainty (e.g. <span class="RktVal">#t</span>) &ndash; it&rsquo;s the difference between these, and <span class="emph">not existing at all</span>.</p><p>The same considerations extend the other way as well, from nonexistence to existence to existence of more than one. As each value corresponds to an independent logical span of possibilities, sunyata in the context of Qi translates into the core paradigm being the existence/non-existence and consequently also the number of values at each point in the flow.</p><p>In practice, this means that Qi will often opt to either return or not return a value rather than return a value signifying absence or raise an error. This principle even suggests considerations for the design of ordinary functions and the evaluator itself, which from a Qi/sunyata perspective, could model absence and number in positions that typically expect values.</p><p>For example, the following would seem to be in accord with these principles:</p><ul><li><p>Variadic functions, on receiving no input, produce a nullary value (e.g. a monoid identity) if applicable, or no output otherwise, instead of raising an error. For instance, <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._max%29%29" class="RktValLink" data-pltdoc="x">max</a></span><span class="RktPn">)</span> currently raises an error, and under this guideline would produce no output, instead.</p></li><li><p>Upon receiving multiple values in positions where a single value is expected, the evaluator "forks" the continuation so that each possibility is independently (combinatorially) evaluated. The results from these parallel computations could be "flattened" as multiple output values, but it may be more correct to evaluate them instead as completely independent computations. These could be manipulated distinctly &ndash; for instance, each forked continuation could be fulfilled by a distinct process, and the evaluator could provide a means to refer to the output of these processes from within the language or in a metalanguage, while keeping the processes themselves abstracted. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span> independently produces <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span> and <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span>.</p></li><li><p>Upon receiving <span class="emph">no</span> values in positions where a single value is expected, there are a few cases to consider. If no values were received in a position corresponding to the "object" of the function, in the grammatical sense, then the function produces no values. If no values were received in another position, then the function produces the input object(s) (again, objects in the grammatical sense) &ndash; which would be consistent with the expected output type. If there is more than one object position, then the result of the function is empty if <span class="emph">any</span> of the object positions is. If no values were received in a position serving another grammatical role (e.g. a modifier or adverb such as a function-valued argument), the function generally produces nothing. In none of these cases does the function raise an error. <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span> produces <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span>, while <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym">add-two-numbers</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktVal">5</span><span class="RktPn">)</span>, and <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._sort%29%29" class="RktValLink" data-pltdoc="x">sort</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" class="RktValLink" data-pltdoc="x">values</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span> (where the first argument position indicates a comparator function to be used in sorting) produce nothing.</p></li><li><p>If the function receives valid inputs but is unable to produce a valid result (for instance, if the inputs fail some runtime requirement), it produces nothing.</p></li><li><p>If an <span class="emph">invalid</span> input (such as one of an unexpected type) is received, the function raises an error.</p></li></ul><p>See <a href="Qi_Macros.html#%28part._.Write_.Yourself_a_.Maybe_.Monad_for_.Great_.Good%29" data-pltdoc="x">Write Yourself a Maybe Monad for Great Good</a> for an example that applies some of these ideas to implement the Maybe monad commonly used in many functional languages. Although, note that if the above design were adopted by the underlying language and interpreter, Maybe would be unnecessary in most cases.</p><h4 class="heading">9.7<tt>&nbsp;</tt><a name="(part._.Phrases)"></a>Phrases<span class="button-group"><a href="#(part._.Phrases)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>When reading languages like English, we understand what we read in terms of words and then phrases and the relationship of these phrases to one another as clauses of a sentence, and then the relationship of sentences to one another, and then paragraphs to one another. The resourceful speed readers among us even do this in the reverse order at first, discerning high level structure before parsing the low level component meanings. Just like human languages, Qi expressions exhibit phrase structure that we can leverage in similar ways. Here are some common phrases in the language to get you started thinking about the language in this way.</p><ul><li><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktSym">&#9651;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">&gt;&lt;</span><span class="stt"> </span><span class="RktSym">f</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span> &ndash; "sep-amp". A standard mapping over values extracted from a list.</p></li><li><p><span class="RktPn">(</span><span class="RktSym">&#9651;</span><span class="stt"> </span><span class="RktSym">&#9661;</span><span class="RktPn">)</span> &ndash; "zip". A standard way to collect corresponding elements of lists.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span> &ndash; "augment". The tee junction may augment the flow in any order &ndash; the signature of this phrase is the presence of a <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span> in the tee junction.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="stt"> </span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="stt"> </span><span class="RktSym">g</span><span class="RktPn">)</span> &ndash; "diamond composition". This is one way to adapt a flow <span class="RktSym">f</span> of arity <span class="math">k</span> to a flow <span class="RktSym">g</span> of arity <span class="math">m</span>, that is, by branching the <span class="math">k</span> inputs into <span class="math">m</span> copies of <span class="RktSym">f</span> (assuming <span class="RktSym">f</span> produces one output). It is the same as the "composition operator" used in defining <a href="https://en.wikipedia.org/wiki/Primitive_recursive_function">primitive recursive functions</a>.</p></li><li><p><span class="RktPn">(</span><span class="RktSym">group</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktSym">car-flo</span><span class="stt"> </span><span class="RktSym">cdr-flo</span><span class="RktPn">)</span> &ndash; "pare". This is analogous to "car and cdr" style destructuring with lists, but for segregating values instead. Note that while it is analogous, this isn&rsquo;t "destructuring," since the values taken together <a href="#%28part._.Values_are_.Not_.Collections%29" data-pltdoc="x">do not form a data structure</a>.</p></li></ul><p>Some of these phrases may someday make it into the language as forms themselves, and there may be higher-level phrases still, made up of such phrases.</p><h4 class="heading">9.8<tt>&nbsp;</tt><a name="(part._.Identities)"></a>Identities<span class="button-group"><a href="#(part._.Identities)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Here are some useful identities for the core routing forms. They can be used to simplify your code or say things in different ways.</p><p><div class="math">(\sim&gt; (\sim&gt; f g) h) = (\sim&gt; f (\sim&gt; g h)) = (\sim&gt; f g h)</div> [associative law]
<div class="math">(\sim&gt; f \_) = (\sim&gt; \_ f) = (\sim&gt; f) = f</div> [left and right identity]
<div class="math">(== (\sim&gt; f&#8321; g&#8321;) (\sim&gt; f&#8322; g&#8322;)) = (\sim&gt; (== f&#8321; f&#8322;) (== g&#8321; g&#8322;))</div>
<div class="math">(\sim&gt; (&gt;&lt; f) (&gt;&lt; g)) = (&gt;&lt; (\sim&gt; f g))</div>
<div class="math">(\sim&gt; \_ \cdots) = \_</div>
<div class="math">(== \_ \ldots) = \_</div>
<div class="math">(&gt;&lt; \_) = \_</div>
<div class="math">(-&lt; f) = f</div>
<div class="math">(-&lt; (\text{gen} a) (\text{gen} b)) = (-&lt; (\text{gen} a b))</div>
<div class="math">(\sim&gt; &#9651; &#9661;) = \_ = (\sim&gt; &#9661; &#9651;) \text{(the former only holds when the input is a list)}</div></p><h4 class="heading">9.9<tt>&nbsp;</tt><a name="(part._.Flows_and_.Arrows)"></a>Flows and Arrows<span class="button-group"><a href="#(part._.Flows_and_.Arrows)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>[<span class="emph">The connection between flows and arrows was pointed out by Sergiu Ivanov (Scolobb on Discourse).</span>]</p><p>It turns out that the core routing forms of Qi fulfill the definition of <a href="https://www.haskell.org/arrows/">arrows</a> in category theory and Haskell (in an unfortunate conflation of terminology, these "arrows" are an entirely different notion than morphisms, which are also sometimes referred to as arrows). The specific correspondence is as follows:</p><ul><li><p>Qi&rsquo;s "base case" of <a href="#%28part._.What_is_a_.Flow_%29" data-pltdoc="x">treating any function as a flow</a> corresponds to the <span class="RktSym">arr</span> method of arrows.</p></li><li><p><span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span> is equivalent to the <span class="RktPn">(</span><span class="RktSym">&gt;&gt;&gt;</span><span class="RktPn">)</span> of arrows.</p></li><li><p>The <span class="RktSym">relay</span>, and specifically, <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="stt"> </span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span>, and <span class="RktPn">(</span><span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._~3d~3d%29%29" class="RktStxLink" data-pltdoc="x">==</a></span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span>, respectively correspond to <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._first%29%29" class="RktValLink" data-pltdoc="x">first</a></span>, <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._second%29%29" class="RktValLink" data-pltdoc="x">second</a></span>, and their composite <span class="RktPn">(</span><span class="RktSym">***</span><span class="RktPn">)</span> in arrows.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&lt;</span></span><span class="stt"> </span><span class="RktSym">f</span><span class="stt"> </span><span class="RktSym">g</span><span class="RktPn">)</span> corresponds to what is referred to as "fanout composition", <span class="RktPn">(</span><span class="RktSym">&amp;&amp;&amp;</span><span class="RktPn">)</span>, in arrows.</p></li></ul><p>So evidently, flows are just <a href="https://www.sciencedirect.com/science/article/pii/S1571066106001666/pdf">monoids in suitable subcategories of bifunctors</a> (what&rsquo;s the problem?), or, in another way of looking at it, <a href="https://bentnib.org/arrows.pdf">enriched Freyd categories</a>.</p><p>Therefore, any theoretical results about arrows should generally apply to Qi as well (but not necessarily, since Qi is not <span class="emph">just</span> arrows).</p><h4 class="heading">9.10<tt>&nbsp;</tt><a name="(part._.It_s_.Languages_.All_the_.Way_.Down)"></a>It&rsquo;s Languages All the Way Down<span class="button-group"><a href="#(part._.It_s_.Languages_.All_the_.Way_.Down)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Qi is a language implemented on top of another language, Racket, by means of a macro called <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._flow%29%29" class="RktStxLink" data-pltdoc="x">flow</a></span>. All of the other macros that serve as Qi&rsquo;s <a href="Qi_Macros.html#%28part._.Embedding_a_.Hosted_.Language%29" data-pltdoc="x">embedding</a> into Racket, such as (the Racket macros) <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span> and <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._switch%29%29" class="RktStxLink" data-pltdoc="x">switch</a></span>, expand to a use of <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._flow%29%29" class="RktStxLink" data-pltdoc="x">flow</a></span>.</p><p>The <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._flow%29%29" class="RktStxLink" data-pltdoc="x">flow</a></span> form accepts Qi syntax and (like any <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28tech._macro%29" class="techoutside" data-pltdoc="x"><span class="techinside">macro</span></a>) produces Racket syntax. It does this in two stages:</p><ol><li><p>Expansion, where the Qi source expression is translated to a small core language (<a href="#%28part._.The_.Qi_.Core_.Language%29" data-pltdoc="x">Core Qi</a>).</p></li><li><p>Compilation, where the Core Qi expression is optimized and then translated into Racket.</p></li></ol><p>All of this happens at <a href="http://pkg-build.racket-lang.org/doc/guide/phases.html" data-pltdoc="x">compile time</a>, and consequently, the generated Racket code is then itself <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28part._expansion%29" data-pltdoc="x">expanded</a> to a <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28part._fully-expanded%29" data-pltdoc="x">small core language</a> and then <a href="http://pkg-build.racket-lang.org/doc/reference/syntax-model.html#%28tech._compiled%29" class="techoutside" data-pltdoc="x"><span class="techinside">compiled</span></a> to <a href="http://pkg-build.racket-lang.org/doc/guide/performance.html#%28part._.J.I.T%29" data-pltdoc="x">bytecode</a> for evaluation in the runtime environment, as usual.</p><p>Thus, Qi is a special kind of <a href="Qi_Macros.html#%28part._.Hosted_.Languages%29" data-pltdoc="x">hosted language</a>, one that happens to have the same architecture as the host language, Racket, in terms of having distinct expansion and compilation steps. This gives it a lot of flexibility in its implementation, including allowing much of its surface syntax to be implemented as <a href="Qi_Macros.html" data-pltdoc="x">Qi macros</a> (for instance, Qi&rsquo;s <span class="RktSym"><a href="Language_Interface.html#%28form._%28%28lib._qi%2Fmain..rkt%29._switch%29%29" class="RktStxLink" data-pltdoc="x">switch</a></span> expands to a use of Qi&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span> just as Racket&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" class="RktStxLink" data-pltdoc="x">cond</a></span> expands to a use of Racket&rsquo;s <span class="RktSym"><a href="http://pkg-build.racket-lang.org/doc/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span>), allowing it to be naturally macro-extensible by users, and lending it the ability to <a href="When_Should_I_Use_Qi_.html#%28part._.Don_t_.Stop_.Me_.Now%29" data-pltdoc="x">perform optimizations on the core language</a> that allow idiomatic code to be performant.</p><p>This architecture is achieved through the use of <a href="https://download.racket-lang.org/releases/8.17/doc/local-redirect/index.html?doc=syntax-spec-v2&amp;rel=index.html" class="Sq" data-pltdoc="x">Syntax Spec</a>, following the general approach described in <a href="https://dl.acm.org/doi/abs/10.1145/3674627">Compiled, Extensible, Multi-language DSLs (Ballantyne et. al.)</a> and <a href="https://dl.acm.org/doi/abs/10.1145/3428297">Macros for Domain-Specific Languages (Ballantyne et. al.)</a>.</p><h4 class="heading">9.11<tt>&nbsp;</tt><a name="(part._.The_.Qi_.Core_.Language)"></a>The Qi Core Language<span class="button-group"><a href="#(part._.The_.Qi_.Core_.Language)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Qi flow expressions expand to a small core language which is then <a href="#%28part._.It_s_.Languages_.All_the_.Way_.Down%29" data-pltdoc="x">optimized and compiled to Racket</a>. The core language specification is given below. This syntax is a subset of the <a href="Qi_Forms.html#%28part._.Syntax%29" data-pltdoc="x">full Qi language</a>.</p><p><table cellspacing="0" cellpadding="0"><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">floe</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">_</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">gen</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">sep</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">sep</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">collect</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">esc</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">clos</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">as</span><span class="hspace">&nbsp;</span><span class="RktVar">identifier</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">all</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">any</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">none</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">and</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">or</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">not</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">NOT</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">!</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">XOR</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">ground</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">thread</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">relay</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">relay</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">tee</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">tee</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">fanout</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">fanout</span><span class="hspace">&nbsp;</span><span class="RktVar">nat</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">feedback</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">feedback</span><span class="hspace">&nbsp;</span><span class="RktVar">nat</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">feedback</span><span class="hspace">&nbsp;</span><span class="RktVar">nat</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">then</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">feedback</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">while</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">feedback</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">while</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">then</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">select</span><span class="hspace">&nbsp;</span><span class="RktVar">index</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">block</span><span class="hspace">&nbsp;</span><span class="RktVar">index</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">group</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">group</span><span class="hspace">&nbsp;</span><span class="RktVar">nat</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">sieve</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">sieve</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">partition</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">if</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">if</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">amp</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">amp</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">pass</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">pass</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">&lt;&lt;</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">&lt;&lt;</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">&lt;&lt;</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">&gt;&gt;</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">&gt;&gt;</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">&gt;&gt;</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">loop</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">loop</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">loop</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">loop</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">loop2</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">appleye</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">qi:*</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">#%blanket-template</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktVar">__</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">#%fine-template</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktVar">_</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">#%partial-application-form</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">#%deforestable</span><span class="hspace">&nbsp;</span><span class="RktVar">identifier</span><span class="hspace">&nbsp;</span><span class="RktVar">identifier</span><span class="hspace">&nbsp;</span><span class="RktVar">deforestable-clause</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">deforestable-clause</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span><span class="RktVar">floe</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktVar">e</span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">a-racket-expression</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">index</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">exact-positive-integer?</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">nat</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">exact-nonnegative-integer?</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td></tr><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">identifier</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">a-racket-identifier</span></td></tr></table></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Field_Guide.html" title="backward to &quot;8 Field Guide&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Qi: An Embeddable Flow-Oriented Language&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="When_Should_I_Use_Qi_.html" title="forward to &quot;10 When Should I Use Qi?&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>